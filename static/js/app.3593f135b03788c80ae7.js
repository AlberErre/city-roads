webpackJsonp([1],{"4Nv0":function(t,e){},HvW6:function(t,e){},LVrL:function(t,e,n){var r=n("/5HI"),o=n("MeRj").place;t.exports=function(t){var e=[],n=[],i=(new Date).toISOString();t.forEachElement(function(t){"node"===t.type?e.push(t):"way"===t.type&&n.push(t)});var a=new r;return o.write({version:1,id:t.id,date:i,name:t.name,nodes:e,ways:n},a),a.finish()}},MeRj:function(t,e,n){"use strict";var r=e.place={};r.read=function(t,e){return t.readFields(r._readField,{version:0,name:"",date:"",id:"",nodes:[],ways:[]},e)},r._readField=function(t,e,n){1===t?e.version=n.readVarint():2===t?e.name=n.readString():3===t?e.date=n.readString():4===t?e.id=n.readString():5===t?e.nodes.push(r.node.read(n,n.readVarint()+n.pos)):6===t&&e.ways.push(r.way.read(n,n.readVarint()+n.pos))},r.write=function(t,e){if(t.version&&e.writeVarintField(1,t.version),t.name&&e.writeStringField(2,t.name),t.date&&e.writeStringField(3,t.date),t.id&&e.writeStringField(4,t.id),t.nodes)for(var n=0;n<t.nodes.length;n++)e.writeMessage(5,r.node.write,t.nodes[n]);if(t.ways)for(n=0;n<t.ways.length;n++)e.writeMessage(6,r.way.write,t.ways[n])},r.node={},r.node.read=function(t,e){return t.readFields(r.node._readField,{id:0,lat:0,lon:0},e)},r.node._readField=function(t,e,n){1===t?e.id=n.readVarint():2===t?e.lat=n.readFloat():3===t&&(e.lon=n.readFloat())},r.node.write=function(t,e){t.id&&e.writeVarintField(1,t.id),t.lat&&e.writeFloatField(2,t.lat),t.lon&&e.writeFloatField(3,t.lon)},r.way={},r.way.read=function(t,e){return t.readFields(r.way._readField,{nodes:[]},e)},r.way._readField=function(t,e,n){1===t&&n.readPackedVarint(e.nodes)},r.way.write=function(t,e){t.nodes&&e.writePackedVarint(1,t.nodes)}},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("7+uW"),o=n("Zrlr"),i=n.n(o),a=n("5dBV"),s=n.n(a),u=n("gBtx"),c=n.n(u),l=n("AMV0"),f=n.n(l),h={render:function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{staticClass:"loader",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",width:"12",height:"12",fill:"black"}},[e("path",{attrs:{opacity:".25",d:"M16 0 A16 16 0 0 0 16 32 A16 16 0 0 0 16 0 M16 4 A12 12 0 0 1 16 28 A12 12 0 0 1 16 4"}}),this._v(" "),e("path",{attrs:{d:"M16 0 A16 16 0 0 1 32 16 L28 16 A12 12 0 0 0 16 4z"}},[e("animateTransform",{attrs:{attributeName:"transform",type:"rotate",from:"0 16 16",to:"360 16 16",dur:"0.8s",repeatCount:"indefinite"}})],1)])},staticRenderFns:[]},d=n("VU/8")(null,h,!1,null,null,null).exports,p=n("woOf"),v=n.n(p),m=n("//Fk"),g=n.n(m),y=n("wxAW"),b=n.n(y),w=n("fZjL"),M=n.n(w),x=n("puH/"),A=n.n(x),E=function(){function t(e){i()(this,t),A()(this),this.callback=e||Function.prototype}return b()(t,[{key:"cancel",value:function(){this.isCancelled=!0,this.fire("cancel")}},{key:"notify",value:function(t){this.isCancelled||this.callback(t)}},{key:"onCancel",value:function(t){this.on("cancel",t,this)}},{key:"offCancel",value:function(t){this.off("cancel",t)}}]),t}();function _(t,e){e||(e={});var n=void 0,r=e.progress||new E;return r.on&&r.onCancel(o),new g.a(function(i,a){n=new XMLHttpRequest,"function"==typeof r.notify&&n.addEventListener("progress",function(t){t.lengthComputable?r.notify({loaded:t.loaded,total:t.total,percent:t.loaded/t.total,lengthComputable:!0}):r.notify({loaded:t.loaded,lengthComputable:!1})},!1);n.addEventListener("load",function(){if(r.offCancel(o),!r.isCancelled)if(200===n.status){var s=n.response;"json"===e.responseType&&"string"==typeof s&&(s=JSON.parse(s)),setTimeout(function(){return i(s)},0)}else a({statusError:n.status,message:"Unexpected status code "+n.status+" when calling "+t})},!1),n.addEventListener("error",function(){a("Failed to download "+t)},!1),n.addEventListener("abort",function(){a({cancelled:!0,message:"Cancelled download of "+t})},!1),n.open(e.method||"GET",t),e.responseType&&(n.responseType=e.responseType);e.headers&&M()(e.headers).forEach(function(t){n.setRequestHeader(t,e.headers[t])});"POST"===e.method?n.send(e.body):n.send(null)});function o(){!0,n&&n.abort()}}var P=["https://overpass.kumi.systems/api/interpreter","https://overpass-api.de/api/interpreter","https://overpass.openstreetmap.ru/cgi/interpreter"];var L=n("ifoU"),C=n.n(L),S=function(){function t(){i()(this,t),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}return b()(t,[{key:"growBy",value:function(t){this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t}},{key:"addPoint",value:function(t,e){if(void 0===t)throw new Error("Point is not defined");var n=t,r=e;void 0===r&&(n=t.x,r=t.y),n<this.minX&&(this.minX=n),n>this.maxX&&(this.maxX=n),r<this.minY&&(this.minY=r),r>this.maxY&&(this.maxY=r)}},{key:"addRect",value:function(t){if(!t)throw new Error("rect is not defined");this.addPoint(t.left,t.top),this.addPoint(t.right,t.top),this.addPoint(t.left,t.bottom),this.addPoint(t.right,t.bottom)}},{key:"merge",value:function(t){t.minX<this.minX&&(this.minX=t.minX),t.minY<this.minY&&(this.minY=t.minY),t.maxX>this.maxX&&(this.maxX=t.maxX),t.maxY>this.maxY&&(this.maxY=t.maxY)}},{key:"left",get:function(){return this.minX}},{key:"top",get:function(){return this.minY}},{key:"right",get:function(){return this.maxX}},{key:"bottom",get:function(){return this.maxY}},{key:"width",get:function(){return this.maxX-this.minX}},{key:"height",get:function(){return this.maxY-this.minY}},{key:"cx",get:function(){return(this.minX+this.maxX)/2}},{key:"cy",get:function(){return(this.minY+this.maxY)/2}}]),t}(),R=n("qC7P"),T=function(){function t(){i()(this,t),this.elements=[],this.bounds=new S,this.nodes=new C.a,this.wayPointCount=0,this.id=0,this.name="",this.isArea=!0,this.projector=void 0}return b()(t,[{key:"setName",value:function(t){this.name=t}},{key:"setId",value:function(t){this.id=t}},{key:"setIsArea",value:function(t){this.isArea=t}},{key:"setBBox",value:function(t){this.bboxString=t}},{key:"hasRoads",value:function(){return this.wayPointCount>0}},{key:"setProjector",value:function(t){this.projector=t}},{key:"getProjectedRect",value:function(){var t=this.bounds,e=this.getProjector(),n=e({lon:t.left,lat:t.bottom}),r=e({lon:t.right,lat:t.top}),o=n.x,i=n.y,a=r.y,s=r.x;return{left:o,top:i,right:s,bottom:a,width:s-o,height:Math.abs(a-i)}}},{key:"forEachElement",value:function(t){this.elements.forEach(t)}},{key:"forEachWay",value:function(t,e,n){var r=this.nodes,o=this.getProjector();this.elements.forEach(function(i){if("way"===i.type){var a=i.nodes,s=r.get(a[0]);if(s){var u=o(s);e&&e(i);for(var c=1;c<a.length;++c)if(s=r.get(a[c])){var l=o(s);t(u,l),u=l}n&&n(i)}}})}},{key:"getProjector",value:function(){var t=[0,0];this.projector||(this.projector=Object(R.a)(),this.projector.center([this.bounds.cx,this.bounds.cy]).scale(6371393));var e=this.projector;return function(n){var r=n.lon,o=n.lat;t[0]=r,t[1]=o;var i=e(t);return{x:i[0],y:-i[1]}}}}],[{key:"fromPBF",value:function(e){if(1!==e.version)throw new Error("Unknown version "+e.version);var n=[];e.nodes.forEach(function(t){t.type="node",n.push(t)}),e.ways.forEach(function(t){t.type="way",n.push(t)});var r=t.fromOSMResponse(n);return r.setName(e.name),r.setId(e.id),r}},{key:"fromOSMResponse",value:function(e){var n=new t,r=n.nodes,o=n.bounds,i=0;return e.forEach(function(t){"node"===t.type?(r.set(t.id,t),o.addPoint(t.lon,t.lat)):"way"===t.type&&(i+=t.nodes.length)}),n.elements=e,n.wayPointCount=i,n}}]),t}(),k=new C.a;function I(t){var e=k.get(t);return e?g.a.resolve(e):_("https://nominatim.openstreetmap.org/search?format=json&q="+encodeURIComponent(t),{responseType:"json"}).then(O).then(function(e){return k.set(t,e),e})}function O(t){return t.map(function(t){var e=void 0,n=void 0;return"relation"===t.osm_type?e=t.osm_id+36e8:"way"===t.osm_type&&(e=t.osm_id+24e8),t.boundingbox&&(n=[s()(t.boundingbox[0]),s()(t.boundingbox[2]),s()(t.boundingbox[1]),s()(t.boundingbox[3])]),{areaId:e,bbox:n,lat:t.lat,lon:t.lon,osmId:t.osm_id,osmType:t.osm_type,name:t.display_name,type:t.type}})}var F=function(){function t(e,n){i()(this,t),this.queryBounds=e.bounds,this.queryString=e.queryString,this.progress=n,this.promise=null}return b()(t,null,[{key:"runFromOptions",value:function(e,n){return e.getQueryTemplate().then(function(e){return new t(e,n).run()})}}]),b()(t,[{key:"run",value:function(){var t=this;if(this.promise)return this.promise;var e=function(t){var e=/{{geocode(.+?):(.+?)}}/,n=void 0,r=[];for(;n=t.match(e);)r.push(t.substr(0,n.index)),r.push({geoType:n[1],name:n[2]}),t=t.substr(n.index+n[0].length);return r.push(t),r}(this.queryString);return this.promise=function(t){var e=0;return function n(){if(e>=t.length)return g.a.resolve();var r=t[e];e+=1;if("string"==typeof r)return n();return I(r.name).then(B).then(function(t){if(!t)throw new Error("No areas found for request "+r.name);v()(r,t)}).then((o=1e3,function(t){return new g.a(function(e){setTimeout(function(){return e(t)},o)})})).then(n);var o}().then(function(){return t.map(function(t){return"string"==typeof t?t:"Area"===t.geoType?"area("+t.areaId+")":"Coords"===t.geoType?t.lat+","+t.lon:"Id"===t.geoType?t.osmType+"("+t.osmId+")":"Bbox"===t.geoType?t.bbox.join(","):void 0}).join("")})}(e).then(function(e){return function(t,e){var n={method:"POST",responseType:"json",progress:e=e||new E,headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:"data="+encodeURIComponent(t)},r=0;return o(P[r]);function o(t){return _(t,n).catch(i)}function i(t){if(t.cancelled)throw t;if(r>=P.length-1)throw t;return t.statusError&&e.notify({loaded:-1}),o(P[r+=1])}}(e,t.progress)}).then(function(e){var n=T.fromOSMResponse(e.elements);return n.queryBounds=t.queryBounds,n}),this.promise}}]),t}();F.All="way",F.Building="way[building]",F.Road="way[highway]",F.RoadBasic='way[highway~"^(motorway|primary|secondary|tertiary)|residential"]',F.RoadStrict='way[highway~"^(((motorway|trunk|primary|secondary|tertiary)(_link)?)|unclassified|residential|living_street|pedestrian|service|track)$"][area!=yes]';var D=F;function B(t){if(t.length>0)return t[0]}var N=n("3zJd"),j=n.n(N)()({},{useSearch:!0}),q={isCacheEnabled:function(){return 0!=j.get("cache")},enableCache:function(){return j.unset("cache")},get:function(){return j.get.apply(j,arguments)},set:function(){return j.set.apply(j,arguments)},unset:function(){return j.unset.apply(j,arguments)},unsetPlace:function(){j.unset("areaId"),j.unset("osm_id"),j.unset("bbox")}},Y=n("YrBu"),V=n.n(Y),z={areaServer:"https://city-roads.s3-us-west-2.amazonaws.com/nov-02-2020",getDefaultLineColor:function(){return V()("rgba(26, 26, 26, 0.8)")},getLabelColor:function(){return V()("#161616")},getBackgroundColor:function(){return V()("#F7F2E8")}},U=function(){function t(e){i()(this,t),this.place=void 0,this.projector=void 0,this.wayFilter=void 0,this.timeout=900,this.maxHeapByteSize=1073741824,this.outputMethod="skel",v()(this,e)}return b()(t,null,[{key:"parse",value:function(e,n,r){var o=new t;if("string"==typeof r&&(o.place=r),n&&(o.wayFilter=n),!r)return o;v()(o,r);var i=function(t,e){if(void 0===e)return;if("number"==typeof e){var n=t.queryLayerAll();return n[e]}return"string"==typeof e?t.queryLayer(e):e}(e,r.layer);if(i){o.projector=i.getGridProjector();var a=i.getQueryBounds();!a||o.place||o.areaId||o.bbox||(o.place=a.place,o.areaId=a.areaId,o.bbox=a.bbox)}return r.projector&&(o.projector=projector),o}}]),b()(t,[{key:"getQueryTemplate",value:function(){var t=this;if(this.raw)return g.a.resolve({queryString:this.raw});if(!this.wayFilter)throw new Error("Way filter is required");return this.getBounds().then(function(e){var n=void 0;if(e.areaId)n="[timeout:"+t.timeout+"][maxsize:"+t.maxHeapByteSize+"][out:json];\narea("+e.areaId+");\n(._; )->.area;\n("+t.wayFilter+"(area.area); node(w););\nout "+t.outputMethod+";";else if(e.bbox){var r=function(t){return t&&t.join(",")}(e.bbox);n="[timeout:"+t.timeout+"][maxsize:"+t.maxHeapByteSize+"][bbox:"+r+"][out:json];\n("+t.wayFilter+"; node(w););\nout "+t.outputMethod+";"}return{bounds:e,queryString:n}})}},{key:"getBounds",value:function(){if(this.place)return I(this.place).then(function(t){return t&&t[0]});if(this.areaId)return g.a.resolve({areaId:this.areaId});if(this.bbox)return g.a.resolve({bbox:this.bbox});throw new Error("Please specify bounding area for the query (place|areaId|bbox)")}}]),t}();var G={name:"FindPlace",components:{LoadingIcon:d},data:function(){var t=q.get("q")||"",e=X();return{enteredInput:t,loading:null,lastCancel:null,suggestionsLoaded:!1,boxInTheMiddle:!0,stillLoading:0,error:null,hideInput:!1,noRoads:!1,clicked:!1,showWarning:e,mainActionText:e?"Download Area":"Find City Bounds",suggestions:[]}},watch:{enteredInput:function(){this.mainActionText="Find City Bounds",this.showWarning=!1,this.hideInput=!1,q.unsetPlace()}},mounted:function(){this.$refs.input.focus()},beforeDestroy:function(){this.lastCancel&&this.lastCancel(),clearInterval(this.notifyStillLoading)},methods:{onSubmit:function(){var t=this;q.set("q",this.enteredInput),this.cancelRequest(),this.suggestions=[],this.noRoads=!1,this.error=!1,this.showWarning=!1;var e=X(this.enteredInput);if(e)this.pickSuggestion(e);else{encodeURIComponent(this.enteredInput);this.loading="Searching cities that match your query...",I(this.enteredInput).then(function(e){t.loading=null,t.hideInput=e&&e.length,t.boxInTheMiddle?(t.boxInTheMiddle=!1,setTimeout(function(){t.suggestionsLoaded=!0,t.suggestions=e},50)):(t.suggestionsLoaded=!0,t.suggestions=e)})}},getBugReportURL:function(t){var e=encodeURIComponent("OSM Error"),n="";return t&&(n="Hello, an error occurred on the website:\n\n```\n"+t.toString()+"\n```\n\n Can you please help?"),"https://github.com/anvaka/city-roads/issues/new?title="+e+"&body="+encodeURIComponent(n)},updateProgress:function(t){if(this.stillLoading=0,clearInterval(this.notifyStillLoading),t.loaded<0)return this.loading="Trying a different server",void this.restartLoadingMonitor();void 0!==t.percent?this.loading="Loaded "+Math.round(100*t.percent)+"% ("+W(t.loaded)+" bytes)...":this.loading="Loaded "+W(t.loaded)+" bytes..."},retry:function(){this.lastSuggestion&&this.pickSuggestion(this.lastSuggestion)},pickSuggestion:function(t){var e=this;this.lastSuggestion=t,this.error=!1,q.isCacheEnabled()&&t.areaId?this.checkCache(t).catch(function(n){if(!n.cancelled)return e.useOSM(t)}):this.useOSM(t)},restartLoadingMonitor:function(){var t=this;clearInterval(this.notifyStillLoading),this.stillLoading=0,this.notifyStillLoading=setInterval(function(){t.stillLoading++},1e4)},checkCache:function(t){var e=this;this.loading="Checking cache...";var r=t.areaId;return _(z.areaServer+"/"+r+".pbf",{progress:this.generateNewProgressToken(),responseType:"arraybuffer"}).then(function(t){return new Uint8Array(t)}).then(function(t){var r=n("/5HI"),o=n("MeRj").place,i=new r(t),a=o.read(i),s=T.fromPBF(a);e.$emit("loaded",s)})},useOSM:function(t){var e=this;this.loading="Connecting to OpenStreetMap...",this.restartLoadingMonitor(),D.runFromOptions(new U({wayFilter:D.Road,areaId:t.areaId,bbox:t.bbox}),this.generateNewProgressToken()).then(function(n){var r;e.loading=null,n.hasRoads()?(n.setName(t.name),n.setId(t.areaId||t.osm_id),n.setIsArea(t.areaId),n.setBBox((r=t.bbox)&&r.join(",")),e.$emit("loaded",n)):e.noRoads=!0}).catch(function(t){t.cancelled?e.loading=null:(console.error(t),e.error=t,e.loading=null,e.suggestions=[])}).finally(function(){clearInterval(e.notifyStillLoading),e.stillLoading=0})},cancelRequest:function(){this.progressToken&&(this.progressToken.cancel(),this.progressToken=null,this.loading=!1)},generateNewProgressToken:function(){return this.progressToken&&(this.progressToken.cancel(),this.progressToken=null),this.progressToken=new E(this.updateProgress),this.progressToken}}};function W(t){return f()(t)?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"N/A"}function X(t){var e=function(){var t=q.get("areaId");f()(c()(t,10))||(t=null);return t}();if(e)return{name:t,areaId:e};var n=function(){var t=q.get("osm_id");if(!f()(c()(t,10)))return;var e=function(t){if(!t)return null;var e=t.split(",").map(function(t){return s()(t)}).filter(function(t){return f()(t)});return 4===e.length?e:null}(q.get("bbox"));if(!e)return;return{osm_id:t,bbox:e}}();return n?{name:t,osm_id:n.osm_id,bbox:n.bbox}:void 0}var H={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"find-place",class:{centered:t.boxInTheMiddle}},[t.boxInTheMiddle?n("div",[n("h3",{staticClass:"site-header"},[t._v("city roads")]),t._v(" "),n("p",{staticClass:"description"},[t._v("This website renders every single road within a city")])]):t._e(),t._v(" "),n("form",{staticClass:"search-box",on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.enteredInput,expression:"enteredInput"}],ref:"input",staticClass:"query-input",attrs:{type:"text",placeholder:"Enter a city name to start"},domProps:{value:t.enteredInput},on:{input:function(e){e.target.composing||(t.enteredInput=e.target.value)}}}),t._v(" "),t.enteredInput&&!t.hideInput?n("a",{staticClass:"search-submit",attrs:{type:"submit",href:"#"},on:{click:function(e){return e.preventDefault(),t.onSubmit(e)}}},[t._v(t._s(t.mainActionText))]):t._e()]),t._v(" "),t.showWarning?n("div",{staticClass:"prompt message note shadow"},[t._v("\n    Note: Large cities may require 200MB+ of data transfer and may need a powerful device to render.\n  ")]):t._e(),t._v(" "),t.loading?t._e():n("div",{staticClass:"results"},[t.suggestionsLoaded&&t.suggestions.length?n("div",{staticClass:"suggestions shadow"},[t._m(0),t._v(" "),n("ul",t._l(t.suggestions,function(e,r){return n("li",{key:r},[n("a",{staticClass:"suggestion",attrs:{href:"#"},on:{click:function(n){return n.preventDefault(),t.pickSuggestion(e)}}},[n("span",[t._v("\n          "+t._s(e.name)+" "),n("small",[t._v("("+t._s(e.type)+")")])])])])}),0)]):t._e(),t._v(" "),!t.suggestionsLoaded||t.suggestions.length||t.loading||t.error?t._e():n("div",{staticClass:"no-results message shadow"},[t._v("\n      Didn't find matching cities. Try a different query?\n    ")]),t._v(" "),t.noRoads?n("div",{staticClass:"no-results message shadow"},[t._v("\n      Didn't find any roads. Try a different query?\n    ")]):t._e()]),t._v(" "),t.error?n("div",{staticClass:"error message shadow"},[n("div",[t._v("Sorry, we were not able to download data from the OpenStreetMap.\n    It could be very busy at the moment processing other requests. "),n("br"),n("br"),t._v(" Please bookmark this website and "),n("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.retry(e)}}},[t._v("try again")]),t._v(" later?")]),t._v(" "),n("div",{staticClass:"error-links"},[n("a",{attrs:{href:"https://twitter.com/anvaka/status/1218971717734789120",title:"see what it supposed to do",target:"_blank"}},[t._v("see how it should have worked")]),t._v(" "),n("a",{attrs:{href:t.getBugReportURL(t.error),title:"report error: "+t.error,target:"_blank"}},[t._v("report this bug")])])]):t._e(),t._v(" "),t.loading?n("div",{staticClass:"loading message shadow"},[n("loading-icon"),t._v(" "),n("span",[t._v(t._s(t.loading))]),t._v(" "),n("a",{staticClass:"cancel-request",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.cancelRequest(e)}}},[t._v("cancel")]),t._v(" "),t.stillLoading>0?n("div",{staticClass:"load-padding"},[t._v("\n      Still loading...\n    ")]):t._e(),t._v(" "),t.stillLoading>1?n("div",{staticClass:"load-padding"},[t._v("\n      Sorry it takes so long!\n    ")]):t._e()],1):t._e()])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"prompt message"},[e("div",[this._v("Select boundaries below to download all roads within")]),this._v(" "),e("div",{staticClass:"note"},[this._v("large cities may require 200MB+ of data transfer and a powerful device")])])}]};var $=n("VU/8")(G,H,!1,function(t){n("4Nv0")},null,null).exports,Q=[],Z="@@clickoutsideContext",K=void 0,J=0;function tt(t,e,n){return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n&&n.context&&r.target&&o.target&&!t.contains(r.target)&&!t.contains(o.target)&&t!==r.target&&(!n.context.popperElm||!n.context.popperElm.contains(r.target)&&!n.context.popperElm.contains(o.target))){var i=t[Z].methodName;e.expression&&i&&n.context[i]?n.context[i]():t[Z].bindingFn&&t[Z].bindingFn()}}}document.addEventListener("mousedown",function(t){return K=t},!0),document.addEventListener("mouseup",function(t){Q.forEach(function(e){return e[Z].documentHandler(t,K)})},!0),document.addEventListener("touchstart",function(t){K=t},!0),document.addEventListener("touchend",function(t){Q.forEach(function(e){return e[Z].documentHandler(t,K)})},!0);var et={bind:function(t,e,n){Q.push(t);var r=J++;t[Z]={id:r,documentHandler:tt(t,e,n),methodName:e.expression,bindingFn:e.value}},update:function(t,e,n){t[Z].documentHandler=tt(t,e,n),t[Z].methodName=e.expression,t[Z].bindingFn=e.value},unbind:function(t){for(var e=Q.length,n=0;n<e;n++)if(Q[n][Z].id===t[Z].id){Q.splice(n,1);break}delete t[Z]}},nt={name:"EditableLabel",props:["value","printable","overlayManager"],directives:{ClickOutside:et},mounted:function(){this.$el.receiveFocus=this.focus,this.$el.style.pointerEvents="none"},methods:{looseFocus:function(){this.$refs.input.blur()},focus:function(){this.$refs.input.focus()}}},rt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.looseFocus,expression:"looseFocus"}],staticClass:"can-drag"},[n("div",{staticClass:"editable-label"},[n("span",{class:{printable:t.printable}},[t._v(t._s(t.value))]),t._v(" "),n("input",{ref:"input",domProps:{value:t.value},on:{input:function(e){return t.$emit("input",e.target.value)}}})])])},staticRenderFns:[]};var ot=n("VU/8")(nt,rt,!1,function(t){n("WJCp")},null,null).exports,it=n("Zzkc"),at={name:"vue-colorpicker",components:{"sketch-picker":it.Sketch},directives:{ClickOutside:et},props:{value:{type:Object}},data:function(){return{showPicker:!1,colors:{hex:"#FFFFFF",a:1},colorValue:"#FFFFFF",panelLeft:"0px",panelTop:"0px"}},computed:{pickerType:function(){return"sketch-picker"},isTransparent:function(){return 0===this.colors.a},btnStyle:function(){if(this.isTransparent)return{background:"#eee",backgroundImage:"linear-gradient(45deg, rgba(0,0,0,.25) 25%, transparent 0, transparent 75%,rgba(0,0,0,.25)0), linear-gradient(45deg, rgba(0,0,0,.25)25%,transparent 0, transparent 75%,rgba(0,0,0,.25)0)",backgroundPosition:"0 0, 11px 11px",backgroundSize:"22px 22px"};var t=this.colorValue;return{background:"rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")"}}},watch:{value:function(t,e){t!==e&&this.updateColorObject(t)},showPicker:function(t){if(t){var e=this.$refs.triggerButton.getBoundingClientRect(),n=e.x,r=e.bottom;e.y+320>window.innerHeight&&(r=Math.max(0,window.innerHeight-320),n+=36),n+220>window.innerWidth&&(n=Math.max(0,window.innerWidth-220)),this.panelLeft=n+"px",this.panelTop=r+"px"}}},methods:{hide:function(){this.showPicker=!1},changeColor:function(t){this.colorValue=t.rgba,this.$emit("input",this.colorValue),this.$emit("change",this.colorValue)},updateColorObject:function(t){if(t){var e=V()(t);this.colors=t&&"transparent"!==t?{hex:e.toHexString(),hsl:e.toHsl(),hsv:e.toHsv(),rgba:e.toRgb(),a:e.getAlpha()}:{hex:"#FFFFFF",hsl:{h:0,s:0,l:1,a:0},hsv:{h:0,s:0,v:1,a:0},rgba:{r:255,g:255,b:255,a:0},a:0},this.colorValue=this.colors.rgba}}},mounted:function(){this.updateColorObject(this.value)}},st={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.hide,expression:"hide"}],staticClass:"vue-colorpicker",on:{click:function(e){t.showPicker=!0}}},[n("span",{ref:"triggerButton",staticClass:"vue-colorpicker-btn",style:t.btnStyle}),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showPicker,expression:"showPicker"}],staticClass:"vue-colorpicker-panel",style:{left:t.panelLeft,top:t.panelTop}},[n(t.pickerType,{tag:"component",on:{input:t.changeColor},model:{value:t.colors,callback:function(e){t.colors=e},expression:"colors"}})],1)])},staticRenderFns:[]};var ut=n("VU/8")(at,st,!1,function(t){n("Z2f9")},"data-v-a5fc1b7c",null).exports,ct=A()({}),lt=n("TzaH"),ft=0,ht=function(){function t(){i()(this,t),this._color=z.getDefaultLineColor(),this.grid=null,this.lines=null,this.scene=null,this.dx=0,this.dy=0,this.scale=1,this.hidden=!1,this.id="paths_"+ft,this._lineWidth=1,ft+=1}return b()(t,[{key:"color",get:function(){return this._color},set:function(t){var e=V()(t);this._color=e,this.lines&&(this.lines.color=dt(e.toRgb())),this.scene&&this.scene.renderFrame()}},{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.lines&&this.scene&&this.lines.setLineWidth(t)}}]),b()(t,[{key:"getGridProjector",value:function(){if(this.grid)return this.grid.projector}},{key:"getQueryBounds",value:function(){var t=this.grid;if(t){if(t.queryBounds)return t.queryBounds;if(t.isArea)return{areaId:t.id}}}},{key:"setGrid",value:function(t){this.grid=t,this.scene&&this.bindToScene(this.scene)}},{key:"getViewBox",value:function(){if(!this.grid)return null;var t=this.grid.getProjectedRect(),e=t.width,n=t.height,r=Math.max(e,n)/4;return{left:-r,top:r,right:r,bottom:-r}}},{key:"moveTo",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.warn("Please use moveBy() instead. The moveTo() is under construction")}},{key:"moveBy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.dx=t,this.dy=e,this._transferTransform()}},{key:"buildLinesCollection",value:function(){if(this.lines)return this.lines;var t=this.grid,e=new lt.WireCollection(t.wayPointCount,{width:this._lineWidth,allowColors:!1,is3D:!1});t.forEachWay(function(t,n){e.add({from:t,to:n})});var n=V()(this._color).toRgb();e.color=dt(n),e.id=this.id,this.lines=e}},{key:"destroy",value:function(){this.scene&&this.lines&&this.scene.removeChild(this.lines)}},{key:"bindToScene",value:function(t){this.scene&&this.lines&&console.error("You seem to be adding this layer twice..."),this.scene=t,this.grid&&(this.buildLinesCollection(),this.hidden||this.scene.appendChild(this.lines))}},{key:"hide",value:function(){this.hidden||(this.hidden=!0,this.scene&&this.grid&&this.scene.removeChild(this.lines))}},{key:"show",value:function(){this.hidden&&(this.hidden=!1,this.scene&&this.grid?this.scene.appendChild(this.lines):console.log("Layer will be shown when grid is available"))}},{key:"_transferTransform",value:function(){this.lines&&(this.lines.translate([this.dx,this.dy,0]),this.lines.updateWorldTransform(!0),this.scene&&this.scene.renderFrame(!0))}}]),t}();function dt(t){return{r:t.r/255,g:t.g/255,b:t.b/255,a:t.a}}var pt=n("c/Tr"),vt=n.n(pt),mt=n("Dd8w"),gt=n.n(mt),yt=(n("LVrL"),n("KmDb")),bt=n.n(yt),wt=(n("MeRj").place,n("TzaH"));function Mt(t,e){var n=t.getRenderer(),r={open:function(){return"\x3c!-- Generator: https://github.com/anvaka/city-roads\nData © OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\n--\x3e"},close:function(){return t=n.getPixelRatio(),e.printable.map(function(e){if(e.element instanceof SVGSVGElement){var n=e.bounds,r=(n.left,n.top,e.element);r.setAttribute("x",n.left*t),r.setAttribute("y",n.top*t),r.setAttribute("width",n.width*t),r.setAttribute("height",n.height*t);var o=(new XMLSerializer).serializeToString(e.element);return r.removeAttribute("x"),r.removeAttribute("y"),r.removeAttribute("width"),r.removeAttribute("height"),o}var i=e;if(i.text){var a=i.text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),s=i.bounds,u=(s.right-i.paddingRight)*t,c=(s.bottom-i.paddingBottom)*t,l=i.fontSize*t,f=i.fontFamily.replace(/"/g,"'");return'<text text-anchor="end" x="'+u+'" y="'+c+'" fill="'+i.color+'" font-family="'+f+'" font-size="'+l+'">'+a+"</text>"}}).filter(function(t){return t}).join("\n");var t}};return e.minLength&&(r.beforeWrite=function(t){for(var n=0,r=1;r<t.length;++r)if((n+=bt()(t[r].x-t[r-1].x,t[r].y-t[r-1].y))>e.minLength)return!0;return n>e.minLength}),r.round=e.round,wt.toSVG(n,r)}function xt(t){var e=At(),n=e.width,r=e.height,o=document.createElement("canvas"),i=o.getContext("2d");return o.width=n,o.height=r,t.render(),i.drawImage(e,0,0,e.width,e.height,0,0,n,r),g.a.all(_t().map(function(t){return function(t,e){return t?new g.a(function(n,r){var o=window.devicePixelRatio||1;if(t.element instanceof SVGSVGElement){var i=t.element,a=t.bounds,s=new Image;s.width=a.width*o,s.height=a.height*o,s.onload=function(){e.drawImage(s,a.left*o,a.top*o,s.width,s.height),i.removeAttribute("width"),i.removeAttribute("height"),n()},i.setAttribute("width",s.width),i.setAttribute("height",s.height),s.src="data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(i))}else e.save(),e.font=o*t.fontSize+"px "+t.fontFamily,e.fillStyle=t.color,e.textAlign="end",e.fillText(t.text,(t.bounds.right-t.paddingRight)*o,(t.bounds.bottom-t.paddingBottom)*o),e.restore(),n()}):g.a.resolve()}(t,i)})).then(function(){return o})}function At(){return document.querySelector("#canvas")}function Et(t,e){var n;return((n=t||(new Date).toISOString())?n.replace(/[#%&{}\\/?*><$!'":@+`|=]/g,"_"):"")+(e||"")}function _t(){return vt()(document.querySelectorAll(".printable")).map(function(t){var e=window.getComputedStyle(t),n=t.getBoundingClientRect(),r=c()(e.fontSize,10),o=c()(e.paddingRight,10),i=2*c()(e.paddingBottom,10);return{text:t.innerText,bounds:n,fontSize:r,paddingBottom:i,paddingRight:o,color:e.color,fontFamily:e.fontFamily,fill:e.color,element:t}})}function Pt(t){setTimeout(function(){window.URL.revokeObjectURL(t)},45e3)}var Lt=n("TzaH");function Ct(t){var e=Lt.createScene(t),n=z.getDefaultLineColor();e.on("transform",function(t){ct.fire("scene-transform")}),e.on("append-child",function(t){u.fire("layer-added",t)}),e.on("remove-child",function(t){u.fire("layer-removed",t)}),e.setClearColor(247/255,242/255,232/255,1);var r=e.getCamera();r.setMoveSpeed&&(r.setMoveSpeed(200),r.setRotationSpeed(Math.PI/500));var o=e.getGL();o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA);var i=!1,a=[],s=z.getBackgroundColor();document.addEventListener("keydown",h,!0),document.addEventListener("keyup",d,!0);var u={render:function(){e.renderFrame(!0)},clear:function(){a.forEach(function(t){return t.destroy()}),a=[],e.clear()},queryLayerAll:c,queryLayer:l,getRenderer:function(){return e},getWGL:function(){return Lt},version:function(){return"0.0.2"},dispose:function(){e.clear(),e.dispose(),u.fire("dispose",u),document.removeEventListener("keydown",h,!0),document.removeEventListener("keyup",d,!0)},set lineColor(t){a.forEach(function(e){e.color=t}),n=V()(t),ct.fire("line-color",n),u.fire("line-color",n)},get lineColor(){var t=l();return t&&t.color||n},set background(t){var n=(s=V()(t)).toRgb();e.setClearColor(n.r/255,n.g/255,n.b/255,n.a),e.renderFrame(),ct.fire("background-color",s),u.fire("background-color",s)},get background(){return s},add:f,load:function(t,e){var n=U.parse(u,t,e),r=new ht;return r.id=n.place,D.runFromOptions(n).then(function(t){t.setProjector(n.projector),r.setGrid(t)}).catch(function(e){console.error("Could not execute:\n  "+t+"\n  The error was:"),console.error(e),r.destroy()}),f(r),r},saveToPNG:function(t){return e=u,n={name:t},n=n||{},void xt(e).then(function(t){var e=Et(n.name,".png");t.toBlob(function(t){var n=window.URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=e,r.click(),Pt(n)},"image/png")});var e,n},saveToSVG:function(t,e){return function(t,e){e=e||{};var n=Mt(t,gt()({printable:_t()},e)),r=new Blob([n],{type:"image/svg+xml"}),o=window.URL.createObjectURL(r),i=Et(e.name,".svg");setTimeout(function(){var t=document.createElement("a");t.href=o,t.download=i,t.click(),Pt(o)},30)}(u,v()({},{name:t},e))}};return A()(u);function c(t){return t?a.filter(function(e){return e.id===t}):a}function l(t){var e=c(t);if(e)return e[0]}function f(t){if(!(a.indexOf(t)>-1)&&(t.bindToScene(e),a.push(t),1===a.length)){var n=t.getViewBox();n&&e.setViewBox(n)}}function h(t){t.shiftKey&&(i=!0,r.setSpeed&&r.setSpeed(.1))}function d(t){!t.shiftKey&&i&&(r.setSpeed&&r.setSpeed(1),i=!1)}}var St="https://edi6jgnosf.execute-api.us-west-2.amazonaws.com/Stage/put_image",Rt={mug:"168739066664861503"};function Tt(t){var e=t.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,""),n=new FormData;return n.append("image",e),_(St,{method:"POST",responseType:"json",progress:new E(Function.prototype),body:n}).then(function(t){if(!t.success)throw new Error("Failed to upload image");return function(t,e){var n=Rt[t];if(!n)throw new Error("Unknown product kind: "+t);return"https://www.zazzle.com/api/create/at-238058511445368984?rf=238058511445368984&ax=Linkover&pd="+n+"&ed=true&tc=&ic=&t_map_iid="+encodeURIComponent(e)}("mug",t.data.link)}).catch(function(t){throw console.log("error",t),t})}n("YzTF");function kt(){var t=void 0,e={clickedElement:null,x:0,y:0,time:Date.now(),left:0,right:0};return document.addEventListener("mousedown",r),document.addEventListener("mouseup",i),document.addEventListener("touchstart",a,{passive:!1,capture:!0}),document.addEventListener("touchend",s,!0),document.addEventListener("touchcancel",s,!0),{track:function(t,e){t.style.pointerEvents="none",t.classList.add("can-drag"),e&&e.receiveFocus&&(t.receiveFocus=e.receiveFocus)},dispose:function(){document.removeEventListener("mousedown",r),document.removeEventListener("mouseup",i),document.removeEventListener("touchstart",a),document.removeEventListener("touchend",s),document.removeEventListener("touchcancel",s),e.clickedElement=void 0,h()},clear:n};function n(){for(var t=document.querySelectorAll(".overlay-active"),e=0;e<t.length;++e)d(t[e])}function r(t){c(t.clientX,t.clientY,t)}function o(t){f(t.clientX,t.clientY)}function i(t){l(t.clientX,t.clientY)}function a(t){if(!(t.touches.length>1)){var e=t.touches[0];c(e.clientX,e.clientY,t)}}function s(t){if(!(t.changedTouches.length>1)){var e=t.changedTouches[0];l(e.clientX,e.clientY)&&(t.preventDefault(),t.stopPropagation())}}function u(t){if(!(t.touches.length>1)){var e=t.touches[0];f(e.clientX,e.clientY),t.preventDefault(),t.stopPropagation()}}function c(r,i,a){for(var s=function(t,e){for(var n=document.querySelectorAll(".can-drag"),r=0;r<n.length;++r){var o=n[r],i=v(o);if(p(t,e,i))return o}}(r,i),c=document.querySelectorAll(".overlay-active"),l=0;l<c.length;++l){var f=c[l];f!==s&&d(f)}1===c.length&&(e.clickedElement=c[0]);var m=s&&s===e.clickedElement;if(m&&(e.clickedElement.contains(a.target)||(s=null,m=!1)),m&&!s.classList.contains("exclusive")?(h(),(t=document.createElement("div")).classList.add("drag-overlay"),document.body.appendChild(t),document.addEventListener("mousemove",o,!0),document.addEventListener("touchmove",u,{passive:!1,capture:!0}),a.preventDefault(),a.stopPropagation()):e.clickedElement=s,e.x=r,e.y=i,e.time=Date.now(),s){var g=s.getBoundingClientRect();e.dx=g.right-e.x,e.dy=g.bottom-e.y}else n()}function l(t,n){if(e.clickedElement){if(h(),function(t,n){return!(Date.now()-e.time>300)&&bt()(t-e.x,n-e.y)<40}(t,n))return function(t,e,n){if(!t)return;t.style.pointerEvents="",t.classList.contains("overlay-active")?(t.receiveFocus&&t.receiveFocus(),t.classList.add("exclusive")):(t.classList.add("overlay-active"),t.classList.contains("can-resize"))}(e.clickedElement),!0;e.clickedElement=null}}function f(t,n){if(e.clickedElement){var r=e.clickedElement.style;r.right=100*(window.innerWidth-t-e.dx)/window.innerWidth+"%",r.bottom=100*(window.innerHeight-n-e.dy)/window.innerHeight+"%"}}function h(){t&&(document.body.removeChild(t),t=null),document.removeEventListener("mousemove",o,!0),document.removeEventListener("touchmove",u,{passive:!1,capture:!0})}function d(t){t.style.pointerEvents="none",t.classList.remove("overlay-active"),t.classList.remove("exclusive")}function p(t,e,n){return!(t<n.left||t>n.right||e<n.top||e>n.bottom)}function v(t){return t.getBoundingClientRect()}}var It=function t(e,n,r){i()(this,t),this.name=e,this.changeColor=r,this.color=n},Ot={name:"App",components:{FindPlace:$,LoadingIcon:d,EditableLabel:ot,ColorPicker:ut},data:function(){return{placeFound:!1,name:"",zazzleLink:null,generatingPreview:!1,showSettings:!1,settingsOpen:!1,labelColor:z.getLabelColor().toRgb(),backgroundColor:z.getBackgroundColor().toRgb(),layers:[]}},computed:{labelColorRGBA:function(){return Ft(this.labelColor)}},created:function(){ct.on("scene-transform",this.handleSceneTransform),ct.on("background-color",this.syncBackground),ct.on("line-color",this.syncLineColor),this.overlayManager=kt()},beforeDestroy:function(){this.overlayManager.dispose(),this.dispose(),ct.off("scene-transform",this.handleSceneTransform),ct.off("background-color",this.syncBackground),ct.off("line-color",this.syncLineColor)},methods:{dispose:function(){this.scene&&(this.scene.dispose(),window.scene=null)},toggleSettings:function(){this.showSettings=!this.showSettings},handleSceneTransform:function(){this.zazzleLink=null},onGridLoaded:function(t){t.isArea?(q.set("areaId",t.id),q.unset("osm_id"),q.unset("bbox")):t.bboxString&&(q.unset("areaId"),q.set("osm_id",t.id),q.set("bbox",t.bboxString)),this.placeFound=!0,this.name=t.name.split(",")[0];var e=At();e.style.visibility="visible",this.scene=Ct(e),this.scene.on("layer-added",this.updateLayers),this.scene.on("layer-removed",this.updateLayers),window.scene=this.scene;var n=new ht;n.id="lines",n.setGrid(t),this.scene.add(n)},startOver:function(){q.unset("areaId"),q.unsetPlace(),q.unset("q"),q.enableCache(),this.dispose(),this.placeFound=!1,this.zazzleLink=null,this.showSettings=!1,this.backgroundColor=z.getBackgroundColor().toRgb(),this.labelColor=z.getLabelColor().toRgb(),document.body.style.backgroundColor=z.getBackgroundColor().toRgbString(),At().style.visibility="hidden"},toPNGFile:function(t){scene.saveToPNG(this.name)},toSVGFile:function(t){scene.saveToSVG(this.name)},updateLayers:function(){var t=this,e=[],n=0,r=this.scene.getRenderer();r.getRoot().children.forEach(function(o){if(o.color){var i=o.id;i||(i="lines "+(n+=1));var a=V.a.fromRatio(o.color);e.push(new It(i,a,function(e){var n;t.zazzleLink=null,o.color={r:(n=e).r/255,g:n.g/255,b:n.b/255,a:n.a},r.renderFrame(),t.scene.fire("color-change",o)}))}}),e.push(new It("background",this.backgroundColor,this.setBackgroundColor),new It("labels",this.labelColor,function(e){return t.labelColor=e})),this.layers=e,this.zazzleLink=null},syncLineColor:function(){this.updateLayers()},syncBackground:function(t){this.backgroundColor=t.toRgb(),this.updateLayers()},updateBackground:function(){this.setBackgroundColor(this.backgroundColor),this.zazzleLink=null},setBackgroundColor:function(t){this.scene.background=t,document.body.style.backgroundColor=Ft(t),this.zazzleLink=null},zazzleMugPrint:function(){var t=this;if(this.zazzleLink)return window.open(this.zazzleLink,"_blank"),void Dt(this.zazzleLink);this.generatingPreview=!0,xt(this.scene).then(function(e){Tt(e).then(function(e){t.zazzleLink=e,window.open(e,"_blank"),Dt(e),t.generatingPreview=!1}).catch(function(e){t.error=e,t.generatingPreview=!1})})}}};function Ft(t){return"rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")"}function Dt(t){"undefined"!=typeof ga&&ga("send","event",{eventCategory:"Outbound Link",eventAction:"click",eventLabel:t})}var Bt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.placeFound?t._e():n("find-place",{on:{loaded:t.onGridLoaded}}),t._v(" "),n("div",{attrs:{id:"app"}},[t.placeFound?n("div",[n("div",{staticClass:"controls"},[n("a",{staticClass:"print-button",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleSettings(e)}}},[t._v("Customize...")]),t._v(" "),n("a",{staticClass:"try-another",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.startOver(e)}}},[t._v("Try another city")])]),t._v(" "),t.showSettings?n("div",{staticClass:"print-window"},[n("h3",[t._v("Display")]),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col"},[t._v("Colors")]),t._v(" "),n("div",{staticClass:"col colors c-2"},t._l(t.layers,function(e){return n("div",{key:e.name,staticClass:"color-container"},[n("color-picker",{on:{change:e.changeColor},model:{value:e.color,callback:function(n){t.$set(e,"color",n)},expression:"layer.color"}}),t._v(" "),n("div",{staticClass:"color-label"},[t._v(t._s(e.name))])],1)}),0)]),t._v(" "),n("h3",[t._v("Export")]),t._v(" "),n("div",{staticClass:"row"},[n("a",{staticClass:"col",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.zazzleMugPrint()}}},[t._v("Onto a mug")]),t._v(" "),t._m(0)]),t._v(" "),t.zazzleLink||t.generatingPreview?n("div",{staticClass:"preview-actions message"},[t.zazzleLink?n("div",{staticClass:"padded popup-help"},[t._v("\n              If your browser has blocked the new window, "),n("br"),t._v("please "),n("a",{attrs:{href:t.zazzleLink,target:"_blank"}},[t._v("click here")]),t._v("\n              to open it.\n            ")]):t._e(),t._v(" "),t.generatingPreview?n("div",{staticClass:"loading-container"},[n("loading-icon"),t._v("\n              Generating preview url...\n            ")],1):t._e()]):t._e(),t._v(" "),n("div",{staticClass:"row"},[n("a",{staticClass:"col",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toPNGFile(e)}}},[t._v("As an image (.png)")]),t._v(" "),n("span",{staticClass:"col c-2"},[t._v("\n            Save the current screen as a raster image.\n          ")])]),t._v(" "),n("div",{staticClass:"row"},[n("a",{staticClass:"col",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toSVGFile(e)}}},[t._v("As a vector (.svg)")]),t._v(" "),n("span",{staticClass:"col c-2"},[t._v("\n            Save the current screen as a vector image.\n          ")])]),t._v(" "),t._e(),t._v(" "),n("h3",[t._v("About")]),t._v(" "),t._m(1)]):t._e()]):t._e()]),t._v(" "),t.placeFound?n("editable-label",{staticClass:"city-name",style:{color:t.labelColorRGBA},attrs:{printable:!0,"overlay-manager":t.overlayManager},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}):t._e(),t._v(" "),t.placeFound?n("div",{staticClass:"license printable can-drag",style:{color:t.labelColorRGBA}},[t._v("data "),n("a",{style:{color:t.labelColorRGBA},attrs:{href:"https://www.openstreetmap.org/about/",target:"_blank"}},[t._v("© OpenStreetMap")])]):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"col c-2"},[this._v("\n            Print what you see onto a mug. "),e("br"),this._v("Get a unique gift of your favorite city.\n          ")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("p",[t._v("This website was created by "),n("a",{attrs:{href:"https://twitter.com/anvaka",target:"_blank"}},[t._v("@anvaka")]),t._v(".\n          It downloads roads from OpenStreetMap and renders them with WebGL.\n          ")]),t._v(" "),n("p",[t._v("\n           You can find the entire "),n("a",{attrs:{href:"https://github.com/anvaka/city-roads"}},[t._v("source code here")]),t._v(". \n           If you love this website you can also "),n("a",{attrs:{href:"https://www.paypal.com/paypalme2/anvakos/3"}},[t._v("buy me a coffee")]),t._v(", but you don't have to!\n          ")])])}]};var Nt=n("VU/8")(Ot,Bt,!1,function(t){n("HvW6")},null,null).exports,jt={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"absolute no-webgl"},[n("h3",[t._v("WebGL is not enabled :(")]),t._v(" "),n("p",[t._v("This website renders millions of roads at once.")]),t._v(" "),n("p",[t._v("\n    To render this amount of data fast, the website uses "),n("a",{attrs:{href:"https://get.webgl.org/"}},[t._v("WebGL")]),t._v(",\n    which seem to be not supported by the device that you are using.\n  ")]),t._v(" "),n("p",[t._v("Please try a different device to play with this website")]),t._v(" "),n("img",{attrs:{src:"https://i.imgur.com/Fbbe5a6.png",alt:"demo"}})])}]};var qt=n("VU/8")(null,jt,!1,function(t){n("tvtY")},"data-v-4c133b01",null).exports,Yt=n("49tl"),Vt=n("TzaH");window.addEventListener("error",function(t){if("function"!=typeof ga)return;var e=t?t.message+" in "+t.filename+":"+t.lineno:"Unknown exception";ga("send","exception",{exDescription:e,exFatal:!1})}),r.a.config.productionTip=!1,window.requireModule=Yt.a,window.Query=D,Vt.isWebGLEnabled(document.querySelector("#canvas"))?new r.a({el:"#app",components:{App:Nt},template:"<App/>"}):new r.a({el:"#app",components:{NoWebGL:qt},template:"<NoWebGL/>"})},TzaH:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"ColorAttribute",function(){return Kt}),n.d(e,"Element",function(){return x}),n.d(e,"FloatAttribute",function(){return Wt}),n.d(e,"GLCollection",function(){return te}),n.d(e,"InstancedAttribute",function(){return Jt}),n.d(e,"LineStripCollection",function(){return Lt}),n.d(e,"NumberAttribute",function(){return Xt}),n.d(e,"PointCollection",function(){return vt}),n.d(e,"WireCollection",function(){return Et}),n.d(e,"createGuide",function(){return Yt}),n.d(e,"createScene",function(){return st}),n.d(e,"createSpaceMapCamera",function(){return rt}),n.d(e,"defineProgram",function(){return Qt}),n.d(e,"isWebGLEnabled",function(){return Ct}),n.d(e,"scene",function(){return st}),n.d(e,"toSVG",function(){return Ot}),n.d(e,"utils",function(){return ut});var r=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(n,r,o){if("function"!=typeof r)throw new Error("callback is expected to be a function");var i=e[n];return i||(i=e[n]=[]),i.push({callback:r,ctx:o}),t},off:function(n,r){var o=void 0===n;if(o)return e=Object.create(null),t;if(e[n]){var i="function"!=typeof r;if(i)delete e[n];else for(var a=e[n],s=0;s<a.length;++s)a[s].callback===r&&a.splice(s,1)}return t},fire:function(n){var r,o=e[n];if(!o)return t;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var i=0;i<o.length;++i){var a=o[i];a.callback.apply(a.ctx,r)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t};function o(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function i(t,e){return t(e={exports:{}},e.exports),e.exports}var a=i(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=function(t){e.ARRAY_TYPE=r=t},e.toRadian=function(t){return t*i},e.equals=function(t,e){return Math.abs(t-e)<=n*Math.max(1,Math.abs(t),Math.abs(e))},e.RANDOM=e.ARRAY_TYPE=e.EPSILON=void 0;var n=1e-6;e.EPSILON=n;var r="undefined"!=typeof Float32Array?Float32Array:Array;e.ARRAY_TYPE=r;var o=Math.random;e.RANDOM=o;var i=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,n=arguments.length;n--;)e+=t[n]*t[n];return Math.sqrt(e)})});o(a);a.setMatrixArrayType,a.toRadian,a.equals,a.RANDOM,a.ARRAY_TYPE,a.EPSILON;var s=i(function(t,e){function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new r.ARRAY_TYPE(4);r.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0);return t[0]=1,t[3]=1,t},e.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},e.fromValues=function(t,e,n,o){var i=new r.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=o,i},e.set=function(t,e,n,r,o){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t},e.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},e.invert=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=n*i-o*r;if(!a)return null;return a=1/a,t[0]=i*a,t[1]=-r*a,t[2]=-o*a,t[3]=n*a,t},e.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},e.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},e.multiply=i,e.rotate=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=o*u+a*s,t[2]=r*-s+i*u,t[3]=o*-s+a*u,t},e.scale=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=n[0],u=n[1];return t[0]=r*s,t[1]=o*s,t[2]=i*u,t[3]=a*u,t},e.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},e.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},e.LDU=function(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},e.subtract=s,e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var n=t[0],o=t[1],i=t[2],a=t[3],s=e[0],u=e[1],c=e[2],l=e[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-u)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(i-c)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-l)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))},e.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},e.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},e.sub=e.mul=void 0;var r=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=t[a]}r.default=t,e&&e.set(t,r);return r}(a);function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function i(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*s+i*u,t[1]=o*s+a*u,t[2]=r*c+i*l,t[3]=o*c+a*l,t}function s(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}var u=i;e.mul=u;var c=s;e.sub=c});o(s);s.create,s.clone,s.copy,s.identity,s.fromValues,s.set,s.transpose,s.invert,s.adjoint,s.determinant,s.multiply,s.rotate,s.scale,s.fromRotation,s.fromScaling,s.str,s.frob,s.LDU,s.add,s.subtract,s.exactEquals,s.equals,s.multiplyScalar,s.multiplyScalarAndAdd,s.sub,s.mul;var u=i(function(t,e){function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new r.ARRAY_TYPE(6);r.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0);return t[0]=1,t[3]=1,t},e.clone=function(t){var e=new r.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},e.fromValues=function(t,e,n,o,i,a){var s=new r.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=n,s[3]=o,s[4]=i,s[5]=a,s},e.set=function(t,e,n,r,o,i,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t},e.invert=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=n*i-r*o;if(!u)return null;return u=1/u,t[0]=i*u,t[1]=-r*u,t[2]=-o*u,t[3]=n*u,t[4]=(o*s-i*a)*u,t[5]=(r*a-n*s)*u,t},e.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},e.multiply=i,e.rotate=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=Math.sin(n),l=Math.cos(n);return t[0]=r*l+i*c,t[1]=o*l+a*c,t[2]=r*-c+i*l,t[3]=o*-c+a*l,t[4]=s,t[5]=u,t},e.scale=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=n[0],l=n[1];return t[0]=r*c,t[1]=o*c,t[2]=i*l,t[3]=a*l,t[4]=s,t[5]=u,t},e.translate=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=n[0],l=n[1];return t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=r*c+i*l+s,t[5]=o*c+a*l+u,t},e.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},e.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},e.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},e.subtract=s,e.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},e.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},e.equals=function(t,e){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],u=t[5],c=e[0],l=e[1],f=e[2],h=e[3],d=e[4],p=e[5];return Math.abs(n-c)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-l)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(i-f)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-h)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(s-d)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(u-p)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))},e.sub=e.mul=void 0;var r=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=t[a]}r.default=t,e&&e.set(t,r);return r}(a);function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function i(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=n[0],l=n[1],f=n[2],h=n[3],d=n[4],p=n[5];return t[0]=r*c+i*l,t[1]=o*c+a*l,t[2]=r*f+i*h,t[3]=o*f+a*h,t[4]=r*d+i*p+s,t[5]=o*d+a*p+u,t}function s(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}var u=i;e.mul=u;var c=s;e.sub=c});o(u);u.create,u.clone,u.copy,u.identity,u.fromValues,u.set,u.invert,u.determinant,u.multiply,u.rotate,u.scale,u.translate,u.fromRotation,u.fromScaling,u.fromTranslation,u.str,u.frob,u.add,u.subtract,u.multiplyScalar,u.multiplyScalarAndAdd,u.exactEquals,u.equals,u.sub,u.mul;var c=i(function(t,e){function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new r.ARRAY_TYPE(9);r.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0);return t[0]=1,t[4]=1,t[8]=1,t},e.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},e.clone=function(t){var e=new r.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromValues=function(t,e,n,o,i,a,s,u,c){var l=new r.ARRAY_TYPE(9);return l[0]=t,l[1]=e,l[2]=n,l[3]=o,l[4]=i,l[5]=a,l[6]=s,l[7]=u,l[8]=c,l},e.set=function(t,e,n,r,o,i,a,s,u,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},e.invert=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=l*a-s*c,h=-l*i+s*u,d=c*i-a*u,p=n*f+r*h+o*d;if(!p)return null;return p=1/p,t[0]=f*p,t[1]=(-l*r+o*c)*p,t[2]=(s*r-o*a)*p,t[3]=h*p,t[4]=(l*n-o*u)*p,t[5]=(-s*n+o*i)*p,t[6]=d*p,t[7]=(-c*n+r*u)*p,t[8]=(a*n-r*i)*p,t},e.adjoint=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8];return t[0]=a*l-s*c,t[1]=o*c-r*l,t[2]=r*s-o*a,t[3]=s*u-i*l,t[4]=n*l-o*u,t[5]=o*i-n*s,t[6]=i*c-a*u,t[7]=r*u-n*c,t[8]=n*a-r*i,t},e.determinant=function(t){var e=t[0],n=t[1],r=t[2],o=t[3],i=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return e*(c*i-a*u)+n*(-c*o+a*s)+r*(u*o-i*s)},e.multiply=i,e.translate=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=n[0],d=n[1];return t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=s,t[5]=u,t[6]=h*r+d*a+c,t[7]=h*o+d*s+l,t[8]=h*i+d*u+f,t},e.rotate=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=Math.sin(n),d=Math.cos(n);return t[0]=d*r+h*a,t[1]=d*o+h*s,t[2]=d*i+h*u,t[3]=d*a-h*r,t[4]=d*s-h*o,t[5]=d*u-h*i,t[6]=c,t[7]=l,t[8]=f,t},e.scale=function(t,e,n){var r=n[0],o=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=o*e[3],t[4]=o*e[4],t[5]=o*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},e.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},e.fromQuat=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=n+n,s=r+r,u=o+o,c=n*a,l=r*a,f=r*s,h=o*a,d=o*s,p=o*u,v=i*a,m=i*s,g=i*u;return t[0]=1-f-p,t[3]=l-g,t[6]=h+m,t[1]=l+g,t[4]=1-c-p,t[7]=d-v,t[2]=h-m,t[5]=d+v,t[8]=1-c-f,t},e.normalFromMat4=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],m=e[14],g=e[15],y=n*s-r*a,b=n*u-o*a,w=n*c-i*a,M=r*u-o*s,x=r*c-i*s,A=o*c-i*u,E=l*v-f*p,_=l*m-h*p,P=l*g-d*p,L=f*m-h*v,C=f*g-d*v,S=h*g-d*m,R=y*S-b*C+w*L+M*P-x*_+A*E;if(!R)return null;return R=1/R,t[0]=(s*S-u*C+c*L)*R,t[1]=(u*P-a*S-c*_)*R,t[2]=(a*C-s*P+c*E)*R,t[3]=(o*C-r*S-i*L)*R,t[4]=(n*S-o*P+i*_)*R,t[5]=(r*P-n*C-i*E)*R,t[6]=(v*A-m*x+g*M)*R,t[7]=(m*w-p*A-g*b)*R,t[8]=(p*x-v*w+g*y)*R,t},e.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},e.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},e.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},e.subtract=s,e.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},e.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},e.equals=function(t,e){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=e[0],d=e[1],p=e[2],v=e[3],m=e[4],g=e[5],y=e[6],b=e[7],w=e[8];return Math.abs(n-h)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-d)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(i-p)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-v)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(s-m)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-g)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(c-y)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(l-b)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(f-w)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(w))},e.sub=e.mul=void 0;var r=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=t[a]}r.default=t,e&&e.set(t,r);return r}(a);function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function i(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=n[0],d=n[1],p=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return t[0]=h*r+d*a+p*c,t[1]=h*o+d*s+p*l,t[2]=h*i+d*u+p*f,t[3]=v*r+m*a+g*c,t[4]=v*o+m*s+g*l,t[5]=v*i+m*u+g*f,t[6]=y*r+b*a+w*c,t[7]=y*o+b*s+w*l,t[8]=y*i+b*u+w*f,t}function s(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}var u=i;e.mul=u;var c=s;e.sub=c});o(c);c.create,c.fromMat4,c.clone,c.copy,c.fromValues,c.set,c.identity,c.transpose,c.invert,c.adjoint,c.determinant,c.multiply,c.translate,c.rotate,c.scale,c.fromTranslation,c.fromRotation,c.fromScaling,c.fromMat2d,c.fromQuat,c.normalFromMat4,c.projection,c.str,c.frob,c.add,c.subtract,c.multiplyScalar,c.multiplyScalarAndAdd,c.exactEquals,c.equals,c.sub,c.mul;var l=i(function(t,e){function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new r.ARRAY_TYPE(16);r.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},e.clone=function(t){var e=new r.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.fromValues=function(t,e,n,o,i,a,s,u,c,l,f,h,d,p,v,m){var g=new r.ARRAY_TYPE(16);return g[0]=t,g[1]=e,g[2]=n,g[3]=o,g[4]=i,g[5]=a,g[6]=s,g[7]=u,g[8]=c,g[9]=l,g[10]=f,g[11]=h,g[12]=d,g[13]=p,g[14]=v,g[15]=m,g},e.set=function(t,e,n,r,o,i,a,s,u,c,l,f,h,d,p,v,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t[9]=l,t[10]=f,t[11]=h,t[12]=d,t[13]=p,t[14]=v,t[15]=m,t},e.identity=i,e.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],o=e[3],i=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=i,t[11]=e[14],t[12]=o,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},e.invert=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],m=e[14],g=e[15],y=n*s-r*a,b=n*u-o*a,w=n*c-i*a,M=r*u-o*s,x=r*c-i*s,A=o*c-i*u,E=l*v-f*p,_=l*m-h*p,P=l*g-d*p,L=f*m-h*v,C=f*g-d*v,S=h*g-d*m,R=y*S-b*C+w*L+M*P-x*_+A*E;if(!R)return null;return R=1/R,t[0]=(s*S-u*C+c*L)*R,t[1]=(o*C-r*S-i*L)*R,t[2]=(v*A-m*x+g*M)*R,t[3]=(h*x-f*A-d*M)*R,t[4]=(u*P-a*S-c*_)*R,t[5]=(n*S-o*P+i*_)*R,t[6]=(m*w-p*A-g*b)*R,t[7]=(l*A-h*w+d*b)*R,t[8]=(a*C-s*P+c*E)*R,t[9]=(r*P-n*C-i*E)*R,t[10]=(p*x-v*w+g*y)*R,t[11]=(f*w-l*x-d*y)*R,t[12]=(s*_-a*L-u*E)*R,t[13]=(n*L-r*_+o*E)*R,t[14]=(v*b-p*M-m*y)*R,t[15]=(l*M-f*b+h*y)*R,t},e.adjoint=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],m=e[14],g=e[15],y=n*s-r*a,b=n*u-o*a,w=n*c-i*a,M=r*u-o*s,x=r*c-i*s,A=o*c-i*u,E=l*v-f*p,_=l*m-h*p,P=l*g-d*p,L=f*m-h*v,C=f*g-d*v,S=h*g-d*m;return t[0]=s*S-u*C+c*L,t[1]=o*C-r*S-i*L,t[2]=v*A-m*x+g*M,t[3]=h*x-f*A-d*M,t[4]=u*P-a*S-c*_,t[5]=n*S-o*P+i*_,t[6]=m*w-p*A-g*b,t[7]=l*A-h*w+d*b,t[8]=a*C-s*P+c*E,t[9]=r*P-n*C-i*E,t[10]=p*x-v*w+g*y,t[11]=f*w-l*x-d*y,t[12]=s*_-a*L-u*E,t[13]=n*L-r*_+o*E,t[14]=v*b-p*M-m*y,t[15]=l*M-f*b+h*y,t},e.determinant=function(t){var e=t[0],n=t[1],r=t[2],o=t[3],i=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11],d=t[12],p=t[13],v=t[14],m=t[15],g=e*a-n*i,y=e*s-r*i,b=n*s-r*a,w=c*p-l*d,M=c*v-f*d,x=l*v-f*p;return u*(e*x-n*M+r*w)-o*(i*x-a*M+s*w)+m*(c*b-l*y+f*g)-h*(d*b-p*y+v*g)},e.multiply=s,e.translate=function(t,e,n){var r,o,i,a,s,u,c,l,f,h,d,p,v=n[0],m=n[1],g=n[2];e===t?(t[12]=e[0]*v+e[4]*m+e[8]*g+e[12],t[13]=e[1]*v+e[5]*m+e[9]*g+e[13],t[14]=e[2]*v+e[6]*m+e[10]*g+e[14],t[15]=e[3]*v+e[7]*m+e[11]*g+e[15]):(r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=e[9],d=e[10],p=e[11],t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=f,t[9]=h,t[10]=d,t[11]=p,t[12]=r*v+s*m+f*g+e[12],t[13]=o*v+u*m+h*g+e[13],t[14]=i*v+c*m+d*g+e[14],t[15]=a*v+l*m+p*g+e[15]);return t},e.scale=function(t,e,n){var r=n[0],o=n[1],i=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.rotate=function(t,e,n,o){var i,a,s,u,c,l,f,h,d,p,v,m,g,y,b,w,M,x,A,E,_,P,L,C,S=o[0],R=o[1],T=o[2],k=Math.hypot(S,R,T);if(k<r.EPSILON)return null;S*=k=1/k,R*=k,T*=k,i=Math.sin(n),a=Math.cos(n),s=1-a,u=e[0],c=e[1],l=e[2],f=e[3],h=e[4],d=e[5],p=e[6],v=e[7],m=e[8],g=e[9],y=e[10],b=e[11],w=S*S*s+a,M=R*S*s+T*i,x=T*S*s-R*i,A=S*R*s-T*i,E=R*R*s+a,_=T*R*s+S*i,P=S*T*s+R*i,L=R*T*s-S*i,C=T*T*s+a,t[0]=u*w+h*M+m*x,t[1]=c*w+d*M+g*x,t[2]=l*w+p*M+y*x,t[3]=f*w+v*M+b*x,t[4]=u*A+h*E+m*_,t[5]=c*A+d*E+g*_,t[6]=l*A+p*E+y*_,t[7]=f*A+v*E+b*_,t[8]=u*P+h*L+m*C,t[9]=c*P+d*L+g*C,t[10]=l*P+p*L+y*C,t[11]=f*P+v*L+b*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t},e.rotateX=function(t,e,n){var r=Math.sin(n),o=Math.cos(n),i=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],h=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[4]=i*o+c*r,t[5]=a*o+l*r,t[6]=s*o+f*r,t[7]=u*o+h*r,t[8]=c*o-i*r,t[9]=l*o-a*r,t[10]=f*o-s*r,t[11]=h*o-u*r,t},e.rotateY=function(t,e,n){var r=Math.sin(n),o=Math.cos(n),i=e[0],a=e[1],s=e[2],u=e[3],c=e[8],l=e[9],f=e[10],h=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[0]=i*o-c*r,t[1]=a*o-l*r,t[2]=s*o-f*r,t[3]=u*o-h*r,t[8]=i*r+c*o,t[9]=a*r+l*o,t[10]=s*r+f*o,t[11]=u*r+h*o,t},e.rotateZ=function(t,e,n){var r=Math.sin(n),o=Math.cos(n),i=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],f=e[6],h=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[0]=i*o+c*r,t[1]=a*o+l*r,t[2]=s*o+f*r,t[3]=u*o+h*r,t[4]=c*o-i*r,t[5]=l*o-a*r,t[6]=f*o-s*r,t[7]=h*o-u*r,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotation=function(t,e,n){var o,i,a,s=n[0],u=n[1],c=n[2],l=Math.hypot(s,u,c);if(l<r.EPSILON)return null;return s*=l=1/l,u*=l,c*=l,o=Math.sin(e),i=Math.cos(e),a=1-i,t[0]=s*s*a+i,t[1]=u*s*a+c*o,t[2]=c*s*a-u*o,t[3]=0,t[4]=s*u*a-c*o,t[5]=u*u*a+i,t[6]=c*u*a+s*o,t[7]=0,t[8]=s*c*a+u*o,t[9]=u*c*a-s*o,t[10]=c*c*a+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromXRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromYRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromZRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotationTranslation=u,e.fromQuat2=function(t,e){var n=new r.ARRAY_TYPE(3),o=-e[0],i=-e[1],a=-e[2],s=e[3],c=e[4],l=e[5],f=e[6],h=e[7],d=o*o+i*i+a*a+s*s;d>0?(n[0]=2*(c*s+h*o+l*a-f*i)/d,n[1]=2*(l*s+h*i+f*o-c*a)/d,n[2]=2*(f*s+h*a+c*i-l*o)/d):(n[0]=2*(c*s+h*o+l*a-f*i),n[1]=2*(l*s+h*i+f*o-c*a),n[2]=2*(f*s+h*a+c*i-l*o));return u(t,e,n),t},e.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},e.getScaling=c,e.getRotation=function(t,e){var n=new r.ARRAY_TYPE(3);c(n,e);var o=1/n[0],i=1/n[1],a=1/n[2],s=e[0]*o,u=e[1]*i,l=e[2]*a,f=e[4]*o,h=e[5]*i,d=e[6]*a,p=e[8]*o,v=e[9]*i,m=e[10]*a,g=s+h+m,y=0;g>0?(y=2*Math.sqrt(g+1),t[3]=.25*y,t[0]=(d-v)/y,t[1]=(p-l)/y,t[2]=(u-f)/y):s>h&&s>m?(y=2*Math.sqrt(1+s-h-m),t[3]=(d-v)/y,t[0]=.25*y,t[1]=(u+f)/y,t[2]=(p+l)/y):h>m?(y=2*Math.sqrt(1+h-s-m),t[3]=(p-l)/y,t[0]=(u+f)/y,t[1]=.25*y,t[2]=(d+v)/y):(y=2*Math.sqrt(1+m-s-h),t[3]=(u-f)/y,t[0]=(p+l)/y,t[1]=(d+v)/y,t[2]=.25*y);return t},e.fromRotationTranslationScale=function(t,e,n,r){var o=e[0],i=e[1],a=e[2],s=e[3],u=o+o,c=i+i,l=a+a,f=o*u,h=o*c,d=o*l,p=i*c,v=i*l,m=a*l,g=s*u,y=s*c,b=s*l,w=r[0],M=r[1],x=r[2];return t[0]=(1-(p+m))*w,t[1]=(h+b)*w,t[2]=(d-y)*w,t[3]=0,t[4]=(h-b)*M,t[5]=(1-(f+m))*M,t[6]=(v+g)*M,t[7]=0,t[8]=(d+y)*x,t[9]=(v-g)*x,t[10]=(1-(f+p))*x,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},e.fromRotationTranslationScaleOrigin=function(t,e,n,r,o){var i=e[0],a=e[1],s=e[2],u=e[3],c=i+i,l=a+a,f=s+s,h=i*c,d=i*l,p=i*f,v=a*l,m=a*f,g=s*f,y=u*c,b=u*l,w=u*f,M=r[0],x=r[1],A=r[2],E=o[0],_=o[1],P=o[2],L=(1-(v+g))*M,C=(d+w)*M,S=(p-b)*M,R=(d-w)*x,T=(1-(h+g))*x,k=(m+y)*x,I=(p+b)*A,O=(m-y)*A,F=(1-(h+v))*A;return t[0]=L,t[1]=C,t[2]=S,t[3]=0,t[4]=R,t[5]=T,t[6]=k,t[7]=0,t[8]=I,t[9]=O,t[10]=F,t[11]=0,t[12]=n[0]+E-(L*E+R*_+I*P),t[13]=n[1]+_-(C*E+T*_+O*P),t[14]=n[2]+P-(S*E+k*_+F*P),t[15]=1,t},e.fromQuat=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=n+n,s=r+r,u=o+o,c=n*a,l=r*a,f=r*s,h=o*a,d=o*s,p=o*u,v=i*a,m=i*s,g=i*u;return t[0]=1-f-p,t[1]=l+g,t[2]=h-m,t[3]=0,t[4]=l-g,t[5]=1-c-p,t[6]=d+v,t[7]=0,t[8]=h+m,t[9]=d-v,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.frustum=function(t,e,n,r,o,i,a){var s=1/(n-e),u=1/(o-r),c=1/(i-a);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(o+r)*u,t[10]=(a+i)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i*2*c,t[15]=0,t},e.perspective=function(t,e,n,r,o){var i,a=1/Math.tan(e/2);t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(i=1/(r-o),t[10]=(o+r)*i,t[14]=2*o*r*i):(t[10]=-1,t[14]=-2*r);return t},e.perspectiveFromFieldOfView=function(t,e,n,r){var o=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(o+i);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(o-i)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t},e.ortho=function(t,e,n,r,o,i,a){var s=1/(e-n),u=1/(r-o),c=1/(i-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(o+r)*u,t[14]=(a+i)*c,t[15]=1,t},e.lookAt=function(t,e,n,o){var a,s,u,c,l,f,h,d,p,v,m=e[0],g=e[1],y=e[2],b=o[0],w=o[1],M=o[2],x=n[0],A=n[1],E=n[2];if(Math.abs(m-x)<r.EPSILON&&Math.abs(g-A)<r.EPSILON&&Math.abs(y-E)<r.EPSILON)return i(t);h=m-x,d=g-A,p=y-E,v=1/Math.hypot(h,d,p),a=w*(p*=v)-M*(d*=v),s=M*(h*=v)-b*p,u=b*d-w*h,(v=Math.hypot(a,s,u))?(a*=v=1/v,s*=v,u*=v):(a=0,s=0,u=0);c=d*u-p*s,l=p*a-h*u,f=h*s-d*a,(v=Math.hypot(c,l,f))?(c*=v=1/v,l*=v,f*=v):(c=0,l=0,f=0);return t[0]=a,t[1]=c,t[2]=h,t[3]=0,t[4]=s,t[5]=l,t[6]=d,t[7]=0,t[8]=u,t[9]=f,t[10]=p,t[11]=0,t[12]=-(a*m+s*g+u*y),t[13]=-(c*m+l*g+f*y),t[14]=-(h*m+d*g+p*y),t[15]=1,t},e.targetTo=function(t,e,n,r){var o=e[0],i=e[1],a=e[2],s=r[0],u=r[1],c=r[2],l=o-n[0],f=i-n[1],h=a-n[2],d=l*l+f*f+h*h;d>0&&(d=1/Math.sqrt(d),l*=d,f*=d,h*=d);var p=u*h-c*f,v=c*l-s*h,m=s*f-u*l;(d=p*p+v*v+m*m)>0&&(d=1/Math.sqrt(d),p*=d,v*=d,m*=d);return t[0]=p,t[1]=v,t[2]=m,t[3]=0,t[4]=f*m-h*v,t[5]=h*p-l*m,t[6]=l*v-f*p,t[7]=0,t[8]=l,t[9]=f,t[10]=h,t[11]=0,t[12]=o,t[13]=i,t[14]=a,t[15]=1,t},e.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},e.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},e.subtract=l,e.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},e.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},e.equals=function(t,e){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],p=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b=e[0],w=e[1],M=e[2],x=e[3],A=e[4],E=e[5],_=e[6],P=e[7],L=e[8],C=e[9],S=e[10],R=e[11],T=e[12],k=e[13],I=e[14],O=e[15];return Math.abs(n-b)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(o-w)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(i-M)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(a-x)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(s-A)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-E)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(c-_)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(l-P)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(f-L)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(h-C)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-S)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(p-R)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(v-T)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(T))&&Math.abs(m-k)<=r.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(g-I)<=r.EPSILON*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(y-O)<=r.EPSILON*Math.max(1,Math.abs(y),Math.abs(O))},e.sub=e.mul=void 0;var r=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=t[a]}r.default=t,e&&e.set(t,r);return r}(a);function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function i(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function s(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=e[9],d=e[10],p=e[11],v=e[12],m=e[13],g=e[14],y=e[15],b=n[0],w=n[1],M=n[2],x=n[3];return t[0]=b*r+w*s+M*f+x*v,t[1]=b*o+w*u+M*h+x*m,t[2]=b*i+w*c+M*d+x*g,t[3]=b*a+w*l+M*p+x*y,b=n[4],w=n[5],M=n[6],x=n[7],t[4]=b*r+w*s+M*f+x*v,t[5]=b*o+w*u+M*h+x*m,t[6]=b*i+w*c+M*d+x*g,t[7]=b*a+w*l+M*p+x*y,b=n[8],w=n[9],M=n[10],x=n[11],t[8]=b*r+w*s+M*f+x*v,t[9]=b*o+w*u+M*h+x*m,t[10]=b*i+w*c+M*d+x*g,t[11]=b*a+w*l+M*p+x*y,b=n[12],w=n[13],M=n[14],x=n[15],t[12]=b*r+w*s+M*f+x*v,t[13]=b*o+w*u+M*h+x*m,t[14]=b*i+w*c+M*d+x*g,t[15]=b*a+w*l+M*p+x*y,t}function u(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=r+r,u=o+o,c=i+i,l=r*s,f=r*u,h=r*c,d=o*u,p=o*c,v=i*c,m=a*s,g=a*u,y=a*c;return t[0]=1-(d+v),t[1]=f+y,t[2]=h-g,t[3]=0,t[4]=f-y,t[5]=1-(l+v),t[6]=p+m,t[7]=0,t[8]=h+g,t[9]=p-m,t[10]=1-(l+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function c(t,e){var n=e[0],r=e[1],o=e[2],i=e[4],a=e[5],s=e[6],u=e[8],c=e[9],l=e[10];return t[0]=Math.hypot(n,r,o),t[1]=Math.hypot(i,a,s),t[2]=Math.hypot(u,c,l),t}function l(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}var f=s;e.mul=f;var h=l;e.sub=h});o(l);l.create,l.clone,l.copy,l.fromValues,l.set,l.identity,l.transpose,l.invert,l.adjoint,l.determinant,l.multiply,l.translate,l.scale,l.rotate,l.rotateX,l.rotateY,l.rotateZ,l.fromTranslation,l.fromScaling,l.fromRotation,l.fromXRotation,l.fromYRotation,l.fromZRotation,l.fromRotationTranslation,l.fromQuat2,l.getTranslation,l.getScaling,l.getRotation,l.fromRotationTranslationScale,l.fromRotationTranslationScaleOrigin,l.fromQuat,l.frustum,l.perspective,l.perspectiveFromFieldOfView,l.ortho,l.lookAt,l.targetTo,l.str,l.frob,l.add,l.subtract,l.multiplyScalar,l.multiplyScalarAndAdd,l.exactEquals,l.equals,l.sub,l.mul;var f=i(function(t,e){function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=i,e.clone=function(t){var e=new r.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.length=s,e.fromValues=function(t,e,n){var o=new r.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=n,o},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.set=function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},e.subtract=u,e.multiply=c,e.divide=l,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},e.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},e.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},e.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},e.distance=f,e.squaredDistance=h,e.squaredLength=d,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},e.normalize=function(t,e){var n=e[0],r=e[1],o=e[2],i=n*n+r*r+o*o;i>0&&(i=1/Math.sqrt(i));return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},e.dot=p,e.cross=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=n[0],s=n[1],u=n[2];return t[0]=o*u-i*s,t[1]=i*a-r*u,t[2]=r*s-o*a,t},e.lerp=function(t,e,n,r){var o=e[0],i=e[1],a=e[2];return t[0]=o+r*(n[0]-o),t[1]=i+r*(n[1]-i),t[2]=a+r*(n[2]-a),t},e.hermite=function(t,e,n,r,o,i){var a=i*i,s=a*(2*i-3)+1,u=a*(i-2)+i,c=a*(i-1),l=a*(3-2*i);return t[0]=e[0]*s+n[0]*u+r[0]*c+o[0]*l,t[1]=e[1]*s+n[1]*u+r[1]*c+o[1]*l,t[2]=e[2]*s+n[2]*u+r[2]*c+o[2]*l,t},e.bezier=function(t,e,n,r,o,i){var a=1-i,s=a*a,u=i*i,c=s*a,l=3*i*s,f=3*u*a,h=u*i;return t[0]=e[0]*c+n[0]*l+r[0]*f+o[0]*h,t[1]=e[1]*c+n[1]*l+r[1]*f+o[1]*h,t[2]=e[2]*c+n[2]*l+r[2]*f+o[2]*h,t},e.random=function(t,e){e=e||1;var n=2*r.RANDOM()*Math.PI,o=2*r.RANDOM()-1,i=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=o*e,t},e.transformMat4=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=n[3]*r+n[7]*o+n[11]*i+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*o+n[8]*i+n[12])/a,t[1]=(n[1]*r+n[5]*o+n[9]*i+n[13])/a,t[2]=(n[2]*r+n[6]*o+n[10]*i+n[14])/a,t},e.transformMat3=function(t,e,n){var r=e[0],o=e[1],i=e[2];return t[0]=r*n[0]+o*n[3]+i*n[6],t[1]=r*n[1]+o*n[4]+i*n[7],t[2]=r*n[2]+o*n[5]+i*n[8],t},e.transformQuat=function(t,e,n){var r=n[0],o=n[1],i=n[2],a=n[3],s=e[0],u=e[1],c=e[2],l=o*c-i*u,f=i*s-r*c,h=r*u-o*s,d=o*h-i*f,p=i*l-r*h,v=r*f-o*l,m=2*a;return l*=m,f*=m,h*=m,d*=2,p*=2,v*=2,t[0]=s+l+d,t[1]=u+f+p,t[2]=c+h+v,t},e.rotateX=function(t,e,n,r){var o=[],i=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t},e.rotateY=function(t,e,n,r){var o=[],i=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t},e.rotateZ=function(t,e,n,r){var o=[],i=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t},e.angle=function(t,e){var n=t[0],r=t[1],o=t[2],i=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+o*o),c=Math.sqrt(i*i+a*a+s*s),l=u*c,f=l&&p(t,e)/l;return Math.acos(Math.min(Math.max(f,-1),1))},e.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},e.equals=function(t,e){var n=t[0],o=t[1],i=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(n-a)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(o-s)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(i-u)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))},e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0;var r=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=t[a]}r.default=t,e&&e.set(t,r);return r}(a);function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function i(){var t=new r.ARRAY_TYPE(3);return r.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function s(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function u(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function c(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function l(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function f(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return Math.hypot(n,r,o)}function h(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return n*n+r*r+o*o}function d(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function p(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}var v=u;e.sub=v;var m=c;e.mul=m;var g=l;e.div=g;var y=f;e.dist=y;var b=h;e.sqrDist=b;var w=s;e.len=w;var M=d;e.sqrLen=M;var x,A=(x=i(),function(t,e,n,r,o,i){var a,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)x[0]=t[a],x[1]=t[a+1],x[2]=t[a+2],o(x,x,i),t[a]=x[0],t[a+1]=x[1],t[a+2]=x[2];return t});e.forEach=A});o(f);f.create,f.clone,f.length,f.fromValues,f.copy,f.set,f.add,f.subtract,f.multiply,f.divide,f.ceil,f.floor,f.min,f.max,f.round,f.scale,f.scaleAndAdd,f.distance,f.squaredDistance,f.squaredLength,f.negate,f.inverse,f.normalize,f.dot,f.cross,f.lerp,f.hermite,f.bezier,f.random,f.transformMat4,f.transformMat3,f.transformQuat,f.rotateX,f.rotateY,f.rotateZ,f.angle,f.zero,f.str,f.exactEquals,f.equals,f.forEach,f.sqrLen,f.len,f.sqrDist,f.dist,f.div,f.mul,f.sub;var h=i(function(t,e){function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=i,e.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.fromValues=function(t,e,n,o){var i=new r.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=o,i},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.set=function(t,e,n,r,o){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},e.subtract=s,e.multiply=u,e.divide=c,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},e.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},e.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},e.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},e.distance=l,e.squaredDistance=f,e.length=h,e.squaredLength=d,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},e.normalize=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=n*n+r*r+o*o+i*i;a>0&&(a=1/Math.sqrt(a));return t[0]=n*a,t[1]=r*a,t[2]=o*a,t[3]=i*a,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},e.cross=function(t,e,n,r){var o=n[0]*r[1]-n[1]*r[0],i=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],l=e[0],f=e[1],h=e[2],d=e[3];return t[0]=f*c-h*u+d*s,t[1]=-l*c+h*a-d*i,t[2]=l*u-f*a+d*o,t[3]=-l*s+f*i-h*o,t},e.lerp=function(t,e,n,r){var o=e[0],i=e[1],a=e[2],s=e[3];return t[0]=o+r*(n[0]-o),t[1]=i+r*(n[1]-i),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t},e.random=function(t,e){var n,o,i,a,s,u;e=e||1;do{n=2*r.RANDOM()-1,o=2*r.RANDOM()-1,s=n*n+o*o}while(s>=1);do{i=2*r.RANDOM()-1,a=2*r.RANDOM()-1,u=i*i+a*a}while(u>=1);var c=Math.sqrt((1-s)/u);return t[0]=e*n,t[1]=e*o,t[2]=e*i*c,t[3]=e*a*c,t},e.transformMat4=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3];return t[0]=n[0]*r+n[4]*o+n[8]*i+n[12]*a,t[1]=n[1]*r+n[5]*o+n[9]*i+n[13]*a,t[2]=n[2]*r+n[6]*o+n[10]*i+n[14]*a,t[3]=n[3]*r+n[7]*o+n[11]*i+n[15]*a,t},e.transformQuat=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=n[0],s=n[1],u=n[2],c=n[3],l=c*r+s*i-u*o,f=c*o+u*r-a*i,h=c*i+a*o-s*r,d=-a*r-s*o-u*i;return t[0]=l*c+d*-a+f*-u-h*-s,t[1]=f*c+d*-s+h*-a-l*-u,t[2]=h*c+d*-u+l*-s-f*-a,t[3]=e[3],t},e.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},e.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var n=t[0],o=t[1],i=t[2],a=t[3],s=e[0],u=e[1],c=e[2],l=e[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-u)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(i-c)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-l)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))},e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0;var r=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=t[a]}r.default=t,e&&e.set(t,r);return r}(a);function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function i(){var t=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function s(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function u(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function c(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function l(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2],i=e[3]-t[3];return Math.hypot(n,r,o,i)}function f(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2],i=e[3]-t[3];return n*n+r*r+o*o+i*i}function h(t){var e=t[0],n=t[1],r=t[2],o=t[3];return Math.hypot(e,n,r,o)}function d(t){var e=t[0],n=t[1],r=t[2],o=t[3];return e*e+n*n+r*r+o*o}var p=s;e.sub=p;var v=u;e.mul=v;var m=c;e.div=m;var g=l;e.dist=g;var y=f;e.sqrDist=y;var b=h;e.len=b;var w=d;e.sqrLen=w;var M,x=(M=i(),function(t,e,n,r,o,i){var a,s;for(e||(e=4),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)M[0]=t[a],M[1]=t[a+1],M[2]=t[a+2],M[3]=t[a+3],o(M,M,i),t[a]=M[0],t[a+1]=M[1],t[a+2]=M[2],t[a+3]=M[3];return t});e.forEach=x});o(h);h.create,h.clone,h.fromValues,h.copy,h.set,h.add,h.subtract,h.multiply,h.divide,h.ceil,h.floor,h.min,h.max,h.round,h.scale,h.scaleAndAdd,h.distance,h.squaredDistance,h.length,h.squaredLength,h.negate,h.inverse,h.normalize,h.dot,h.cross,h.lerp,h.random,h.transformMat4,h.transformQuat,h.zero,h.str,h.exactEquals,h.equals,h.forEach,h.sqrLen,h.len,h.sqrDist,h.dist,h.div,h.mul,h.sub;var d=i(function(t,e){function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=d,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},e.setAxisAngle=p,e.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),o=Math.sin(n/2);o>r.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0);return n},e.getAngle=function(t,e){var n=L(t,e);return Math.acos(2*n*n-1)},e.multiply=v,e.rotateX=function(t,e,n){n*=.5;var r=e[0],o=e[1],i=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=o*u+i*s,t[2]=i*u-o*s,t[3]=a*u-r*s,t},e.rotateY=function(t,e,n){n*=.5;var r=e[0],o=e[1],i=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-i*s,t[1]=o*u+a*s,t[2]=i*u+r*s,t[3]=a*u-o*s,t},e.rotateZ=function(t,e,n){n*=.5;var r=e[0],o=e[1],i=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=o*u-r*s,t[2]=i*u+a*s,t[3]=a*u-i*s,t},e.calculateW=function(t,e){var n=e[0],r=e[1],o=e[2];return t[0]=n,t[1]=r,t[2]=o,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-o*o)),t},e.exp=m,e.ln=g,e.pow=function(t,e,n){return g(t,e),P(t,t,n),m(t,t),t},e.slerp=y,e.random=function(t){var e=r.RANDOM(),n=r.RANDOM(),o=r.RANDOM(),i=Math.sqrt(1-e),a=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=a*Math.sin(2*Math.PI*o),t[3]=a*Math.cos(2*Math.PI*o),t},e.invert=function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=n*n+r*r+o*o+i*i,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-o*s,t[3]=i*s,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},e.fromMat3=b,e.fromEuler=function(t,e,n,r){var o=.5*Math.PI/180;e*=o,n*=o,r*=o;var i=Math.sin(e),a=Math.cos(e),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),l=Math.cos(r);return t[0]=i*u*l-a*s*c,t[1]=a*s*l+i*u*c,t[2]=a*u*c-i*s*l,t[3]=a*u*l+i*s*c,t},e.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.setAxes=e.sqlerp=e.rotationTo=e.equals=e.exactEquals=e.normalize=e.sqrLen=e.squaredLength=e.len=e.length=e.lerp=e.dot=e.scale=e.mul=e.add=e.set=e.copy=e.fromValues=e.clone=void 0;var r=l(a),o=l(c),i=l(f),s=l(h);function u(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return u=function(){return t},t}function l(t){if(t&&t.__esModule)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var e=u();if(e&&e.has(t))return e.get(t);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=o?Object.getOwnPropertyDescriptor(t,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}function d(){var t=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function p(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function v(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*l+a*s+o*c-i*u,t[1]=o*l+a*u+i*s-r*c,t[2]=i*l+a*c+r*u-o*s,t[3]=a*l-r*s-o*u-i*c,t}function m(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=Math.sqrt(n*n+r*r+o*o),s=Math.exp(i),u=a>0?s*Math.sin(a)/a:0;return t[0]=n*u,t[1]=r*u,t[2]=o*u,t[3]=s*Math.cos(a),t}function g(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=Math.sqrt(n*n+r*r+o*o),s=a>0?Math.atan2(a,i)/a:0;return t[0]=n*s,t[1]=r*s,t[2]=o*s,t[3]=.5*Math.log(n*n+r*r+o*o+i*i),t}function y(t,e,n,o){var i,a,s,u,c,l=e[0],f=e[1],h=e[2],d=e[3],p=n[0],v=n[1],m=n[2],g=n[3];return(a=l*p+f*v+h*m+d*g)<0&&(a=-a,p=-p,v=-v,m=-m,g=-g),1-a>r.EPSILON?(i=Math.acos(a),s=Math.sin(i),u=Math.sin((1-o)*i)/s,c=Math.sin(o*i)/s):(u=1-o,c=o),t[0]=u*l+c*p,t[1]=u*f+c*v,t[2]=u*h+c*m,t[3]=u*d+c*g,t}function b(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var o=0;e[4]>e[0]&&(o=1),e[8]>e[3*o+o]&&(o=2);var i=(o+1)%3,a=(o+2)%3;n=Math.sqrt(e[3*o+o]-e[3*i+i]-e[3*a+a]+1),t[o]=.5*n,n=.5/n,t[3]=(e[3*i+a]-e[3*a+i])*n,t[i]=(e[3*i+o]+e[3*o+i])*n,t[a]=(e[3*a+o]+e[3*o+a])*n}return t}var w=s.clone;e.clone=w;var M=s.fromValues;e.fromValues=M;var x=s.copy;e.copy=x;var A=s.set;e.set=A;var E=s.add;e.add=E;var _=v;e.mul=_;var P=s.scale;e.scale=P;var L=s.dot;e.dot=L;var C=s.lerp;e.lerp=C;var S=s.length;e.length=S;var R=S;e.len=R;var T=s.squaredLength;e.squaredLength=T;var k=T;e.sqrLen=k;var I=s.normalize;e.normalize=I;var O=s.exactEquals;e.exactEquals=O;var F=s.equals;e.equals=F;var D,B,N,j=(D=i.create(),B=i.fromValues(1,0,0),N=i.fromValues(0,1,0),function(t,e,n){var r=i.dot(e,n);return r<-.999999?(i.cross(D,B,e),i.len(D)<1e-6&&i.cross(D,N,e),i.normalize(D,D),p(t,D,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(i.cross(D,e,n),t[0]=D[0],t[1]=D[1],t[2]=D[2],t[3]=1+r,I(t,t))});e.rotationTo=j;var q,Y,V=(q=d(),Y=d(),function(t,e,n,r,o,i){return y(q,e,o,i),y(Y,n,r,i),y(t,q,Y,2*i*(1-i)),t});e.sqlerp=V;var z,U=(z=o.create(),function(t,e,n,r){return z[0]=n[0],z[3]=n[1],z[6]=n[2],z[1]=r[0],z[4]=r[1],z[7]=r[2],z[2]=-e[0],z[5]=-e[1],z[8]=-e[2],I(t,b(t,z))});e.setAxes=U});o(d);d.create,d.identity,d.setAxisAngle,d.getAxisAngle,d.getAngle,d.multiply,d.rotateX,d.rotateY,d.rotateZ,d.calculateW,d.exp,d.ln,d.pow,d.slerp,d.random,d.invert,d.conjugate,d.fromMat3,d.fromEuler,d.str,d.setAxes,d.sqlerp,d.rotationTo,d.equals,d.exactEquals,d.normalize,d.sqrLen,d.squaredLength,d.len,d.length,d.lerp,d.dot,d.scale,d.mul,d.add,d.set,d.copy,d.fromValues,d.clone;var p=i(function(t,e){function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new r.ARRAY_TYPE(8);r.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0);return t[3]=1,t},e.clone=function(t){var e=new r.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},e.fromValues=function(t,e,n,o,i,a,s,u){var c=new r.ARRAY_TYPE(8);return c[0]=t,c[1]=e,c[2]=n,c[3]=o,c[4]=i,c[5]=a,c[6]=s,c[7]=u,c},e.fromRotationTranslationValues=function(t,e,n,o,i,a,s){var u=new r.ARRAY_TYPE(8);u[0]=t,u[1]=e,u[2]=n,u[3]=o;var c=.5*i,l=.5*a,f=.5*s;return u[4]=c*o+l*n-f*e,u[5]=l*o+f*t-c*n,u[6]=f*o+c*e-l*t,u[7]=-c*t-l*e-f*n,u},e.fromRotationTranslation=c,e.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},e.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.fromMat4=function(t,e){var n=o.create();i.getRotation(n,e);var a=new r.ARRAY_TYPE(3);return i.getTranslation(a,e),c(t,n,a),t},e.copy=f,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.set=function(t,e,n,r,o,i,a,s,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t[6]=s,t[7]=u,t},e.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},e.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},e.getTranslation=function(t,e){var n=e[4],r=e[5],o=e[6],i=e[7],a=-e[0],s=-e[1],u=-e[2],c=e[3];return t[0]=2*(n*c+i*a+r*u-o*s),t[1]=2*(r*c+i*s+o*a-n*u),t[2]=2*(o*c+i*u+n*s-r*a),t},e.translate=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=.5*n[0],u=.5*n[1],c=.5*n[2],l=e[4],f=e[5],h=e[6],d=e[7];return t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=a*s+o*c-i*u+l,t[5]=a*u+i*s-r*c+f,t[6]=a*c+r*u-o*s+h,t[7]=-r*s-o*u-i*c+d,t},e.rotateX=function(t,e,n){var r=-e[0],i=-e[1],a=-e[2],s=e[3],u=e[4],c=e[5],l=e[6],f=e[7],h=u*s+f*r+c*a-l*i,d=c*s+f*i+l*r-u*a,p=l*s+f*a+u*i-c*r,v=f*s-u*r-c*i-l*a;return o.rotateX(t,e,n),r=t[0],i=t[1],a=t[2],s=t[3],t[4]=h*s+v*r+d*a-p*i,t[5]=d*s+v*i+p*r-h*a,t[6]=p*s+v*a+h*i-d*r,t[7]=v*s-h*r-d*i-p*a,t},e.rotateY=function(t,e,n){var r=-e[0],i=-e[1],a=-e[2],s=e[3],u=e[4],c=e[5],l=e[6],f=e[7],h=u*s+f*r+c*a-l*i,d=c*s+f*i+l*r-u*a,p=l*s+f*a+u*i-c*r,v=f*s-u*r-c*i-l*a;return o.rotateY(t,e,n),r=t[0],i=t[1],a=t[2],s=t[3],t[4]=h*s+v*r+d*a-p*i,t[5]=d*s+v*i+p*r-h*a,t[6]=p*s+v*a+h*i-d*r,t[7]=v*s-h*r-d*i-p*a,t},e.rotateZ=function(t,e,n){var r=-e[0],i=-e[1],a=-e[2],s=e[3],u=e[4],c=e[5],l=e[6],f=e[7],h=u*s+f*r+c*a-l*i,d=c*s+f*i+l*r-u*a,p=l*s+f*a+u*i-c*r,v=f*s-u*r-c*i-l*a;return o.rotateZ(t,e,n),r=t[0],i=t[1],a=t[2],s=t[3],t[4]=h*s+v*r+d*a-p*i,t[5]=d*s+v*i+p*r-h*a,t[6]=p*s+v*a+h*i-d*r,t[7]=v*s-h*r-d*i-p*a,t},e.rotateByQuatAppend=function(t,e,n){var r=n[0],o=n[1],i=n[2],a=n[3],s=e[0],u=e[1],c=e[2],l=e[3];return t[0]=s*a+l*r+u*i-c*o,t[1]=u*a+l*o+c*r-s*i,t[2]=c*a+l*i+s*o-u*r,t[3]=l*a-s*r-u*o-c*i,s=e[4],u=e[5],c=e[6],l=e[7],t[4]=s*a+l*r+u*i-c*o,t[5]=u*a+l*o+c*r-s*i,t[6]=c*a+l*i+s*o-u*r,t[7]=l*a-s*r-u*o-c*i,t},e.rotateByQuatPrepend=function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*l+a*s+o*c-i*u,t[1]=o*l+a*u+i*s-r*c,t[2]=i*l+a*c+r*u-o*s,t[3]=a*l-r*s-o*u-i*c,s=n[4],u=n[5],c=n[6],l=n[7],t[4]=r*l+a*s+o*c-i*u,t[5]=o*l+a*u+i*s-r*c,t[6]=i*l+a*c+r*u-o*s,t[7]=a*l-r*s-o*u-i*c,t},e.rotateAroundAxis=function(t,e,n,o){if(Math.abs(o)<r.EPSILON)return f(t,e);var i=Math.hypot(n[0],n[1],n[2]);o*=.5;var a=Math.sin(o),s=a*n[0]/i,u=a*n[1]/i,c=a*n[2]/i,l=Math.cos(o),h=e[0],d=e[1],p=e[2],v=e[3];t[0]=h*l+v*s+d*c-p*u,t[1]=d*l+v*u+p*s-h*c,t[2]=p*l+v*c+h*u-d*s,t[3]=v*l-h*s-d*u-p*c;var m=e[4],g=e[5],y=e[6],b=e[7];return t[4]=m*l+b*s+g*c-y*u,t[5]=g*l+b*u+y*s-m*c,t[6]=y*l+b*c+m*u-g*s,t[7]=b*l-m*s-g*u-y*c,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},e.multiply=v,e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},e.lerp=function(t,e,n,r){var o=1-r;g(e,n)<0&&(r=-r);return t[0]=e[0]*o+n[0]*r,t[1]=e[1]*o+n[1]*r,t[2]=e[2]*o+n[2]*r,t[3]=e[3]*o+n[3]*r,t[4]=e[4]*o+n[4]*r,t[5]=e[5]*o+n[5]*r,t[6]=e[6]*o+n[6]*r,t[7]=e[7]*o+n[7]*r,t},e.invert=function(t,e){var n=w(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},e.normalize=function(t,e){var n=w(e);if(n>0){n=Math.sqrt(n);var r=e[0]/n,o=e[1]/n,i=e[2]/n,a=e[3]/n,s=e[4],u=e[5],c=e[6],l=e[7],f=r*s+o*u+i*c+a*l;t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=(s-r*f)/n,t[5]=(u-o*f)/n,t[6]=(c-i*f)/n,t[7]=(l-a*f)/n}return t},e.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},e.equals=function(t,e){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=e[0],h=e[1],d=e[2],p=e[3],v=e[4],m=e[5],g=e[6],y=e[7];return Math.abs(n-f)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-h)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(i-d)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-p)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-v)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-m)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(c-g)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(l-y)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))},e.sqrLen=e.squaredLength=e.len=e.length=e.dot=e.mul=e.setReal=e.getReal=void 0;var r=u(a),o=u(d),i=u(l);function s(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return s=function(){return t},t}function u(t){if(t&&t.__esModule)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var e=s();if(e&&e.has(t))return e.get(t);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=o?Object.getOwnPropertyDescriptor(t,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}function c(t,e,n){var r=.5*n[0],o=.5*n[1],i=.5*n[2],a=e[0],s=e[1],u=e[2],c=e[3];return t[0]=a,t[1]=s,t[2]=u,t[3]=c,t[4]=r*c+o*u-i*s,t[5]=o*c+i*a-r*u,t[6]=i*c+r*s-o*a,t[7]=-r*a-o*s-i*u,t}function f(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}var h=o.copy;e.getReal=h;var p=o.copy;function v(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=n[4],u=n[5],c=n[6],l=n[7],f=e[4],h=e[5],d=e[6],p=e[7],v=n[0],m=n[1],g=n[2],y=n[3];return t[0]=r*y+a*v+o*g-i*m,t[1]=o*y+a*m+i*v-r*g,t[2]=i*y+a*g+r*m-o*v,t[3]=a*y-r*v-o*m-i*g,t[4]=r*l+a*s+o*c-i*u+f*y+p*v+h*g-d*m,t[5]=o*l+a*u+i*s-r*c+h*y+p*m+d*v-f*g,t[6]=i*l+a*c+r*u-o*s+d*y+p*g+f*m-h*v,t[7]=a*l-r*s-o*u-i*c+p*y-f*v-h*m-d*g,t}e.setReal=p;var m=v;e.mul=m;var g=o.dot;e.dot=g;var y=o.length;e.length=y;var b=y;e.len=b;var w=o.squaredLength;e.squaredLength=w;var M=w;e.sqrLen=M});o(p);p.create,p.clone,p.fromValues,p.fromRotationTranslationValues,p.fromRotationTranslation,p.fromTranslation,p.fromRotation,p.fromMat4,p.copy,p.identity,p.set,p.getDual,p.setDual,p.getTranslation,p.translate,p.rotateX,p.rotateY,p.rotateZ,p.rotateByQuatAppend,p.rotateByQuatPrepend,p.rotateAroundAxis,p.add,p.multiply,p.scale,p.lerp,p.invert,p.conjugate,p.normalize,p.str,p.exactEquals,p.equals,p.sqrLen,p.squaredLength,p.len,p.length,p.dot,p.mul,p.setReal,p.getReal;var v=i(function(t,e){function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=i,e.clone=function(t){var e=new r.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var n=new r.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,n){return t[0]=e,t[1]=n,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},e.subtract=s,e.multiply=u,e.divide=c,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},e.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},e.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},e.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},e.distance=l,e.squaredDistance=f,e.length=h,e.squaredLength=d,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},e.normalize=function(t,e){var n=e[0],r=e[1],o=n*n+r*r;o>0&&(o=1/Math.sqrt(o));return t[0]=e[0]*o,t[1]=e[1]*o,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t},e.lerp=function(t,e,n,r){var o=e[0],i=e[1];return t[0]=o+r*(n[0]-o),t[1]=i+r*(n[1]-i),t},e.random=function(t,e){e=e||1;var n=2*r.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},e.transformMat2=function(t,e,n){var r=e[0],o=e[1];return t[0]=n[0]*r+n[2]*o,t[1]=n[1]*r+n[3]*o,t},e.transformMat2d=function(t,e,n){var r=e[0],o=e[1];return t[0]=n[0]*r+n[2]*o+n[4],t[1]=n[1]*r+n[3]*o+n[5],t},e.transformMat3=function(t,e,n){var r=e[0],o=e[1];return t[0]=n[0]*r+n[3]*o+n[6],t[1]=n[1]*r+n[4]*o+n[7],t},e.transformMat4=function(t,e,n){var r=e[0],o=e[1];return t[0]=n[0]*r+n[4]*o+n[12],t[1]=n[1]*r+n[5]*o+n[13],t},e.rotate=function(t,e,n,r){var o=e[0]-n[0],i=e[1]-n[1],a=Math.sin(r),s=Math.cos(r);return t[0]=o*s-i*a+n[0],t[1]=o*a+i*s+n[1],t},e.angle=function(t,e){var n=t[0],r=t[1],o=e[0],i=e[1],a=Math.sqrt(n*n+r*r)*Math.sqrt(o*o+i*i),s=a&&(n*o+r*i)/a;return Math.acos(Math.min(Math.max(s,-1),1))},e.zero=function(t){return t[0]=0,t[1]=0,t},e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},e.equals=function(t,e){var n=t[0],o=t[1],i=e[0],a=e[1];return Math.abs(n-i)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(o-a)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(a))},e.forEach=e.sqrLen=e.sqrDist=e.dist=e.div=e.mul=e.sub=e.len=void 0;var r=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=t[a]}r.default=t,e&&e.set(t,r);return r}(a);function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function i(){var t=new r.ARRAY_TYPE(2);return r.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function s(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function u(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function c(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function l(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function f(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function h(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function d(t){var e=t[0],n=t[1];return e*e+n*n}var p=h;e.len=p;var v=s;e.sub=v;var m=u;e.mul=m;var g=c;e.div=g;var y=l;e.dist=y;var b=f;e.sqrDist=b;var w=d;e.sqrLen=w;var M,x=(M=i(),function(t,e,n,r,o,i){var a,s;for(e||(e=2),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)M[0]=t[a],M[1]=t[a+1],o(M,M,i),t[a]=M[0],t[a+1]=M[1];return t});e.forEach=x});o(v);v.create,v.clone,v.fromValues,v.copy,v.set,v.add,v.subtract,v.multiply,v.divide,v.ceil,v.floor,v.min,v.max,v.round,v.scale,v.scaleAndAdd,v.distance,v.squaredDistance,v.length,v.squaredLength,v.negate,v.inverse,v.normalize,v.dot,v.cross,v.lerp,v.random,v.transformMat2,v.transformMat2d,v.transformMat3,v.transformMat4,v.rotate,v.angle,v.zero,v.str,v.exactEquals,v.equals,v.forEach,v.sqrLen,v.sqrDist,v.dist,v.div,v.mul,v.sub,v.len;var m=i(function(t,e){function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.vec4=e.vec3=e.vec2=e.quat2=e.quat=e.mat4=e.mat3=e.mat2d=e.mat2=e.glMatrix=void 0;var r=E(a);e.glMatrix=r;var o=E(s);e.mat2=o;var i=E(u);e.mat2d=i;var m=E(c);e.mat3=m;var g=E(l);e.mat4=g;var y=E(d);e.quat=y;var b=E(p);e.quat2=b;var w=E(v);e.vec2=w;var M=E(f);e.vec3=M;var x=E(h);function A(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return A=function(){return t},t}function E(t){if(t&&t.__esModule)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var e=A();if(e&&e.has(t))return e.get(t);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=o?Object.getOwnPropertyDescriptor(t,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}e.vec4=x});o(m);var g=m.vec4,y=m.vec3,b=(m.vec2,m.quat2,m.quat),w=m.mat4,M=(m.mat3,m.mat2d,m.mat2,m.glMatrix),x=function(){this.children=[],this.model=w.create(),this.worldModel=w.create(),this.modelViewProjection=w.create(),this.worldTransformNeedsUpdate=!0,this.modelViewProjectionNeedsUpdate=!0,this.type="Element",this.scene=null,this.parent=null};x.prototype.appendChild=function(t,e){void 0===e&&(e=!1),t.parent=this,e?this.children.unshift(t):this.children.push(t),t.bindScene&&t.bindScene(this.scene),this.scene&&this.scene.renderFrame()},x.prototype.bindScene=function(t){this.scene=t},x.prototype.traverse=function(t,e){t(this);for(var n=0;n<this.children.length;++n){this.children[n].traverse(t,e)}e&&e(this)},x.prototype.rotate=function(t,e){return w.rotate(this.model,this.model,t,e),this.worldTransformNeedsUpdate=!0,this.scene&&this.scene.renderFrame(),this},x.prototype.rotateX=function(t){return w.rotateX(this.model,this.model,t),this.worldTransformNeedsUpdate=!0,this.scene&&this.scene.renderFrame(),this},x.prototype.rotateY=function(t){return w.rotateY(this.model,this.model,t),this.worldTransformNeedsUpdate=!0,this.scene&&this.scene.renderFrame(),this},x.prototype.rotateZ=function(t){return w.rotateZ(this.model,this.model,t),this.worldTransformNeedsUpdate=!0,this.scene&&this.scene.renderFrame(),this},x.prototype.scale=function(t){return w.scale(this.model,this.model,t),this.worldTransformNeedsUpdate=!0,this.scene&&this.scene.renderFrame(),this},x.prototype.translate=function(t){return w.translate(this.model,this.model,t),this.worldTransformNeedsUpdate=!0,this.scene&&this.scene.renderFrame(),this},x.prototype.removeChild=function(t){var e=this.children.indexOf(t);e>-1&&(this.children.splice(e,1),t.bindScene(null)),this.scene&&this.scene.renderFrame()},x.prototype.updateWorldTransform=function(t){void 0===t&&(t=!1),(this.worldTransformNeedsUpdate||t)&&(this.parent?w.multiply(this.worldModel,this.parent.worldModel,this.model):w.copy(this.worldModel,this.model),this.modelViewProjectionNeedsUpdate=!0,this.worldTransformNeedsUpdate=!1,t=!0);for(var e=t,n=this.children,r=0;r<n.length;r++)e=n[r].updateWorldTransform(t)||e;return e},x.prototype.scheduleMVPUpdate=function(){this.modelViewProjectionNeedsUpdate=!0;for(var t=this.children,e=0;e<t.length;e++)t[e].scheduleMVPUpdate()},x.prototype.updateModelViewProjection=function(t,e){this.modelViewProjectionNeedsUpdate&&(w.multiply(this.modelViewProjection,t,e),w.multiply(this.modelViewProjection,this.modelViewProjection,this.worldModel),this.modelViewProjectionNeedsUpdate=!1)},x.prototype.draw=function(t,e){for(var n=0;n<this.children.length;++n){var r=this.children[n];r.updateModelViewProjection(e.projection,e.view.matrix),r.draw(t,e)}},x.prototype.dispose=function(){for(var t=0;t<this.children.length;++t){this.children[t].dispose()}};var A={maxSingleTouchTime:300,singleTapDistanceSquared:25};var E=[0,0,0],_=[1,0,0],P=[0,1,0],L=[0,0,1],C=function(t){this.matrix=t||w.create(),this.cameraWorld=w.invert(w.create(),this.matrix),this.position=[0,0,0],this.rotation=[0,0,0,1],this.deconstructPositionRotation()};C.prototype.lookAt=function(t,e,n){return w.lookAt(this.cameraWorld,t,e,n),this.deconstructPositionRotation(),this},C.prototype.update=function(){return w.fromRotationTranslation(this.cameraWorld,this.rotation,this.position),w.invert(this.matrix,this.cameraWorld),this},C.prototype.deconstructPositionRotation=function(){w.getTranslation(this.position,this.cameraWorld),w.getRotation(this.rotation,this.cameraWorld)},C.prototype.translateOnAxis=function(t,e){var n=y.transformQuat(E,t,this.rotation);return y.scaleAndAdd(this.position,this.position,n,e),this},C.prototype.translateX=function(t){return this.translateOnAxis(_,t)},C.prototype.translateY=function(t){return this.translateOnAxis(P,t)},C.prototype.translateZ=function(t){return this.translateOnAxis(L,t)};var S=4,R=.001,T=1e-7,k=10,I=11,O=1/(I-1),F="function"==typeof Float32Array;function D(t,e){return 1-3*e+3*t}function B(t,e){return 3*e-6*t}function N(t){return 3*t}function j(t,e,n){return((D(e,n)*t+B(e,n))*t+N(e))*t}function q(t,e,n){return 3*D(e,n)*t*t+2*B(e,n)*t+N(e)}function Y(t){return t}var V=function(t,e,n,r){if(!(0<=t&&t<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&n===r)return Y;for(var o=F?new Float32Array(I):new Array(I),i=0;i<I;++i)o[i]=j(i*O,t,n);function a(e){for(var r=0,i=1,a=I-1;i!==a&&o[i]<=e;++i)r+=O;var s=r+(e-o[--i])/(o[i+1]-o[i])*O,u=q(s,t,n);return u>=R?function(t,e,n,r){for(var o=0;o<S;++o){var i=q(e,n,r);if(0===i)return e;e-=(j(e,n,r)-t)/i}return e}(e,s,t,n):0===u?s:function(t,e,n,r,o){var i,a,s=0;do{(i=j(a=e+(n-e)/2,r,o)-t)>0?n=a:e=a}while(Math.abs(i)>T&&++s<k);return a}(e,r,r+O,t,n)}return function(t){return 0===t?0:1===t?1:j(a(t),e,r)}},z={ease:V(.25,.1,.25,1),easeIn:V(.42,0,1,1),easeOut:V(0,0,.58,1),easeInOut:V(.42,0,.58,1),linear:V(0,0,1,1)},U=function(t,e,n){var r=Object.create(null),o=Object.create(null),i="function"==typeof(n=n||{}).easing?n.easing:z[n.easing];i||(n.easing&&console.warn("Unknown easing function in amator: "+n.easing),i=z.ease);var a="function"==typeof n.step?n.step:X,s="function"==typeof n.done?n.done:X,u=function(t){if(!t){var e="undefined"!=typeof window&&window.requestAnimationFrame;return e?{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}:{next:function(t){return setTimeout(t,1e3/60)},cancel:function(t){return clearTimeout(t)}}}if("function"!=typeof t.next)throw new Error("Scheduler is supposed to have next(cb) function");if("function"!=typeof t.cancel)throw new Error("Scheduler is supposed to have cancel(handle) function");return t}(n.scheduler),c=Object.keys(e);c.forEach(function(n){r[n]=t[n],o[n]=e[n]-t[n]});var l,f="number"==typeof n.duration?n.duration:400,h=Math.max(1,.06*f),d=0;return l=u.next(function e(){var n=i(d/h);d+=1,function(e){c.forEach(function(n){t[n]=o[n]*e+r[n]})}(n),d<=h?(l=u.next(e),a(t)):(l=0,setTimeout(function(){s(t)},0))}),{cancel:function(){u.cancel(l),l=0}}},G=H,W=H();function X(){}function H(){var t=new Set,e=new Set,n=0;return{next:r,cancel:r,clearAll:function(){t.clear(),e.clear(),cancelAnimationFrame(n),n=0}};function r(t){e.add(t),n||(n=requestAnimationFrame(o))}function o(){n=0;var r=e;e=t,(t=r).forEach(function(t){t()}),t.clear()}}function $(t,e,n){"object"!=typeof n&&(n={});var r,o,i,a,s,u,c,l,f,h,d=.001,p="number"==typeof n.minVelocity?n.minVelocity:d,v="number"==typeof n.amplitude?n.amplitude:.01,m="function"==typeof n.cancelAnimationFrame?n.cancelAnimationFrame:Q(),g="function"==typeof n.requestAnimationFrame?n.requestAnimationFrame:Z(),y=342;return{start:function(){r=t(),s=c=a=u=l=0,o=new Date,m(i),m(h),i=g(b)},setAmplitude:function(t){v=t},getAmplitude:function(){return v},stop:function(){if(!i)return;m(i),i=0,m(h),h=0,w(a,u,l)},impulse:w,cancel:function(){m(i),m(h)}};function b(){var e=Date.now(),n=e-o;o=e;var s=t(),c=s.x-r.x,f=s.y-r.y,h=(s.z||0)-r.z;r=s;var d=1e3/(1+n);a=.8*c*d+.2*a,u=.8*f*d+.2*u,l=.8*h*d+.2*l,i=g(b)}function w(t,e,n){o=Date.now(),(t<-p||t>p)&&(s=v*t),(e<-p||e>p)&&(c=v*e),(n<-p||n>p)&&(f=v*n),h=g(M)}function M(){var n=Date.now()-o,r=!1,i=0,a=0,u=0,l=Math.exp(-n/y);if(s&&((i=s*l)>d||i<-d?r=!0:i=s=0),c&&((a=c*l)>d||a<-d?r=!0:a=c=0),f&&((u=f*l)>d||u<-d?r=!0:u=f=0),r){var p=t();e(p.x+i,p.y+a,p.z+u),h=g(M)}}}function Q(){return"function"==typeof cancelAnimationFrame?cancelAnimationFrame:clearTimeout}function Z(){return"function"==typeof requestAnimationFrame?requestAnimationFrame:function(t){return setTimeout(t,16)}}U.makeAggregateRaf=G,U.sharedScheduler=W;var K=function(t){this.x=t.clientX,this.y=t.clientY,this.lastX=this.x,this.lastY=this.y,this.id=t.identifier,this.createdAt=Date.now()};K.prototype.move=function(t){this.lastX=this.x,this.lastY=this.y,this.x=t.clientX,this.y=t.clientY};var J=function(t){this.allowRotation=t,this.state=0,this.canRotate=!1,this.canScale=!1,this.canIncline=!1,this.first=void 0,this.second=void 0,this.stateChanged=!1};function tt(t,e){var n,r=!1,o=new Map,i=e.allowRotation,a=e.panAnimation,s=e.rotateAnimation,u=new J(i),c=Date.now(),l=c;return t.addEventListener("touchstart",f,{passive:!1}),{dispose:function(){t.removeEventListener("touchstart",f,{passive:!1}),p()}};function f(t){r||(document.addEventListener("touchmove",h,{passive:!1}),document.addEventListener("touchend",d,{passive:!1}),document.addEventListener("touchcancel ",d,{passive:!1}),r=!0),a.cancel(),s.cancel(),1===t.touches.length&&a.start();for(var e=0;e<t.touches.length;++e){var n=t.touches[e];o.has(n.identifier)||o.set(n.identifier,new K(n))}t.stopPropagation(),t.preventDefault()}function h(t){for(var n,r,i=Date.now(),f=0,h=0,d=0,p=0,v=!1,m=t.touches,g=0;g<m.length;++g){var y=m[g],b=o.get(y.identifier);b&&(b.move(y),d+=b.x,p+=b.y,f+=b.x-b.lastX,h+=b.y-b.lastY,n?r||(r=b):n=b)}var w=m.length;if(f/=w,h/=w,d/=w,p/=w,r||u.reset(),n&&r){l=i;var M=r.x-n.x,x=r.y-n.y,A=r.lastX-n.lastX,E=r.lastY-n.lastY,_=Math.hypot(M,x)/Math.hypot(A,E)-1,P=Math.atan2(x,M)-Math.atan2(E,A);if(u.track(n,r),u.stateChanged&&(s.start(),a.cancel()),u.canScale&&(e.zoomToClientCoordinates(d,p,_),v=!0),u.canRotate&&(e.rotateByAngle(P,0),v=!0),u.canIncline){var L=r.y-r.lastY+n.y-n.lastY;e.rotateByAbsoluteOffset(0,L),v=!0}t.preventDefault(),t.stopPropagation()}var C=i-c,S=u.canIncline||C<300||t.touches.length>1&&u.isUnknown();0===f&&0===h||S||(e.panByAbsoluteOffset(f,h),v=!0),v&&e.redraw()}function d(t){var i=Date.now(),f=i-c;c=i;for(var h=t.changedTouches,d=0;d<h.length;++d){var v=h[d];o.delete(v.identifier)}if(t.touches.length<2&&(u.reset(),s.stop(),a.stop()),0===t.touches.length&&o.clear(),0===o.size&&1===t.changedTouches.length){if(r=!1,p(),a.stop(),f<350&&i-l>350){var m=t.changedTouches[0],g=Math.abs(m.clientX-n.clientX),y=Math.abs(m.clientY-n.clientY);Math.hypot(g,y)<30&&e.zoomToClientCoordinates(n.clientX,n.clientY,.5,!0)}n=t.changedTouches[0]}}function p(){document.removeEventListener("touchmove",h),document.removeEventListener("touchend",d),document.removeEventListener("touchcancel ",d)}}function et(t,e,n){return Math.abs(t)<e?n:t}function nt(t,e){var n,r,o,i=e.allowRotation,a=e.panAnimation,s=e.rotateAnimation;return t.addEventListener("wheel",h,{passive:!1}),t.addEventListener("mousedown",u,{passive:!1}),t.addEventListener("dblclick",f,{passive:!1}),{dispose:function(){t.removeEventListener("wheel",h,{passive:!1}),t.removeEventListener("mousedown",u,{passive:!1}),t.removeEventListener("dblclick",f,{passive:!1}),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",l)}};function u(t){(1===t.button&&null!==window.event||0===t.button)&&(document.addEventListener("mousemove",c),document.addEventListener("mouseup",l),n=t.clientX,r=t.clientY,o=t.altKey&&i,a.cancel(),s.cancel(),o?s.start():a.start())}function c(t){var i=t.clientY-r,a=t.clientX-n;o?e.rotateByAbsoluteOffset(a,i):e.panByAbsoluteOffset(a,i),n=t.clientX,r=t.clientY,e.redraw()}function l(){document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",l),o?s.stop():a.stop()}function f(t){e.zoomToClientCoordinates(t.clientX,t.clientY,.5,!0),t.preventDefault(),t.stopPropagation()}function h(t){var n,r=t.deltaMode>0?100:1,o=(n=-t.deltaY*r,Math.sign(n)*Math.min(.25,Math.abs(n/128)));e.zoomToClientCoordinates(t.clientX,t.clientY,o),t.preventDefault()}}function rt(t){var e=t.getDrawContext(),n=e.view,r=2*Math.PI,o=1.618*Math.PI,i=t.getOptions()||{},a=void 0===i.allowRotation||!!i.allowRotation,s=1,u=at(i.minPhi,-1/0),c=at(i.maxPhi,1/0),l=it(-Math.PI/2,u,c),f=[0,0,1],h=at(i.minTheta,0),d=at(i.maxTheta,Math.PI),p=it(0,h,d),v=e.center,m=n.position,g=$(function(){return{x:v[0],y:v[1],z:v[2]}},function(t,e,n){y.set(v,t,e,n),L()}),b=$(function(){return{x:l,y:p,z:0}},function(t,e){p=it(e,h,d),l=it(t,u,c),L()},{minVelocity:1}),M={dispose:function(){b.cancel(),g.cancel(),E.dispose(),A.dispose(),_.dispose()},setViewBox:function(){m=n.position,s=Math.hypot(m[2]),v[0]=m[0],v[1]=m[1],v[2]=0,p=it(0,h,d),l=it(-Math.PI/2,u,c),L()},panByAbsoluteOffset:function(t,n){var r=e.width/e.height,o=2*s*Math.tan(e.fov/2),i=r*o*t/(e.width/e.pixelRatio),a=o*n/(e.height/e.pixelRatio);!function(t,e){var n=Math.cos(l),r=Math.sin(l);v[0]+=n*e+r*t,v[1]+=r*e-n*t}(i,-a)},slideCenterUpDown:function(t){v[2]+=t*s*.001},rotateByAngle:function(t,e){l=it(l+t,u,c),p=it(p+e,h,d)},rotateByAbsoluteOffset:function(t,n){if(!a)return;var i=e.width/e.height;l-=r*t/e.width,p=it(p-=o*n/e.height*i,h,d),l=it(l,u,c)},zoomCenterByScaleFactor:P,zoomToClientCoordinates:function(e,n,r,o){var i=function(e,n){var r=t.getSceneCoordinate(e,n),o=y.sub([0,0,0],[r.x,r.y,r.z],m);y.normalize(o,o);var i=y.dot(f,o);if(Math.abs(i)>1e-7){var a=y.dot(y.sub([0,0,0],v,m),f)/i;return y.scaleAndAdd([0,0,0],m,o,a)}}(e,n);if(!i)return;var a=i[0]-v[0],u=i[1]-v[1];if(o){var c={r:s,x:v[0],y:v[1]},l={r:s*(1-r),x:c.x+a*r,y:c.y+u*r};U(c,l,{step:function(t){s=t.r,v[0]=t.x,v[1]=t.y,L()}})}else P(r,a,u),L()},redraw:L,allowRotation:a,rotateAnimation:b,panAnimation:g,getRadius:function(){return s}},x=e.canvas,A=function(t,e){var n=0,r=0,o=0,i=0,a=0,s=0,u=0,c=0,l=0,f=0,h=0,d=0,p=0;return t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),t.addEventListener("keydown",g),t.addEventListener("keyup",y),{dispose:function(){t.removeEventListener("keydown",g),t.removeEventListener("keyup",y),cancelAnimationFrame(n)}};function v(){n=0;var t=!1;if(a=et(.9*a+r,.5,0),s=et(.9*s+o,.5,0),u=et(.9*u+i,.5,0),(a||s)&&(e.panByAbsoluteOffset(a,s),t=!0),u&&(e.slideCenterUpDown(u),t=!0),c=et(.9*c+l/2,Math.PI/360,0),d=et(.9*d+p/6,Math.PI/360,0),(c||d)&&(e.rotateByAbsoluteOffset(c,d),t=!0),f=et(.7*f+h,.5,0)){var v=.025*Math.sign(f);e.zoomCenterByScaleFactor(v,0,0),t=!0}t&&(e.redraw(),m())}function m(){n||(n=requestAnimationFrame(v))}function g(t){b(t,1)}function y(t){b(t,0)}function b(t,e){if(!function(t){return t.altKey||t.ctrlKey||t.metaKey}(t)){switch(t.which){case 81:l=-e;break;case 69:l=e;break;case 187:h=e;break;case 189:h=-e;break;case 82:p=e;break;case 70:p=-e;break;case 37:case 65:r=e;break;case 39:case 68:r=-e;break;case 38:case 87:o=e;break;case 40:case 83:o=-e;break;case 71:i=-e;break;case 84:i=e}m()}}}(x,M),E=tt(x,M),_=nt(x,M);return L(),M;function P(t,e,n){s*=1-t,v[0]+=e*t,v[1]+=n*t}function L(){var r=ot(s,p,l),o=Math.hypot(s,1),i=ot(o,p-Math.acos(s/o),l);y.sub(i,i,r),y.set(m,r[0],r[1],r[2]),y.add(m,m,v),w.targetTo(n.matrix,m,v,i),w.getRotation(n.rotation,n.matrix),n.update(),t.getRoot().scheduleMVPUpdate(),t.fire("transform",e),t.renderFrame()}}function ot(t,e,n){var r=t*Math.cos(e);return[t*Math.sin(e)*Math.cos(n),t*Math.sin(e)*Math.sin(n),r]}function it(t,e,n){return t<e&&(t=e),t>n&&(t=n),t}function at(t,e){return void 0===t?e:t}function st(t,e){var n,o;void 0===e&&(e={});var i=e.devicePixelRatio||window.devicePixelRatio,a=e.wglContextOptions,s=t.getContext("webgl",a)||t.getContext("experimental-webgl",a);s.enable(s.BLEND),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA),s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);var u=0,c=new x,l=!1,f=!1,h=new C,d=w.create(),p=w.create(),v=void 0===e.fov?45*Math.PI/180:e.fov,m=void 0===e.near?.01:e.near,M=void 0===e.far?1/0:e.far,E={width:window.innerWidth,height:window.innerHeight,pixelRatio:i,canvas:t,projection:d,view:h,fov:v,center:[0,0,0]};T();var _=r({appendChild:function(t,e){void 0===e&&(e=!1);c.appendChild(t,e),_.fire("append-child",t)},getSceneCoordinate:O,getClientCoordinate:function(t,e,r){void 0===r&&(r=0);var i=w.multiply(w.create(),d,h.matrix);w.multiply(i,i,c.model);var a=g.transformMat4([],[t,e,r,1],i),s=_.getPixelRatio(),u=n*(a[0]/a[3]+1)*.5/s,l=o*(1-.5*(a[1]/a[3]+1))/s;return{x:u,y:l}},getTransform:function(){return c.model},getRoot:function(){return c},getGL:function(){return s},removeChild:function(t){c.removeChild(t),_.fire("remove-child",t)},setViewBox:function(t){var e=E.pixelRatio*Math.max((t.top-t.bottom)/2,(t.right-t.left)/2),n=E.view,r=n.position,o=n.rotation;r[0]=(t.left+t.right)/2,r[1]=(t.top+t.bottom)/2,r[2]=e/Math.tan(E.fov/2),b.set(o,0,0,0,1),E.view.update(),S.setViewBox&&S.setViewBox(t)},setClearColor:function(t,e,n,r){s.clearColor(t,e,n,r)},getClearColor:function(){return s.getParameter(s.COLOR_CLEAR_VALUE)},clear:function(){s.clear(s.COLOR_BUFFER_BIT)},dispose:function(){t.removeEventListener("mousemove",I),L&&L();window.removeEventListener("resize",R,!0),S.dispose(),c.dispose(),u&&(cancelAnimationFrame(u),u=0)},renderFrame:F,getPixelRatio:function(){return i},setPixelRatio:function(t){i=t,E.pixelRatio=i,T()},getCamera:function(){return S},setCamera:function(t){S&&S.dispose();S=t(_,E)},getDrawContext:function(){return E},getOptions:function(){return e}}),P=_.on;_.on=function(t,e,n){"click"===t&&(l=!0);"mousemove"===t&&(f=!0);return P(t,e,n)},c.bindScene(_);var L,S=(e.camera||rt)(_,E);return t.addEventListener("mousemove",I),L=function(t,e,n){var r,o=Date.now();return t.addEventListener("click",s,{passive:!1}),t.addEventListener("touchend",a,{passive:!1}),t.addEventListener("touchstart",i,{passive:!1}),function(){t.removeEventListener("click",s),t.removeEventListener("touchend",a),t.removeEventListener("touchstart",i)};function i(t){1===t.touches.length&&(o=Date.now(),r={x:t.touches[0].pageX,y:t.touches[0].pageY})}function a(t){if(!(t.touches.length>1||Date.now()-o>A.maxSingleTouchTime)){var e=t.changedTouches[0],n=e.pageX-r.x,i=e.pageY-r.y;n*n+i*i<A.singleTapDistanceSquared&&s(e)}}function s(t){e.call(n,t)}}(t,k),window.addEventListener("resize",R,!0),F(),_;function R(){T()}function T(){e.size?(n=t.width=e.size.width,o=t.height=e.size.height):(n=t.width=t.offsetWidth*i,o=t.height=t.offsetHeight*i),s.viewport(0,0,n,o),E.width=n,E.height=o,c.worldTransformNeedsUpdate=!0,w.perspective(d,v,n/o,m,M),p=w.invert(w.create(),d),F()}function k(t){if(l){var e=O(t.clientX,t.clientY);e&&_.fire("click",{originalEvent:t,x:e.x,y:e.y,z:e.z})}}function I(t){if(f){var e=O(t.clientX,t.clientY);e&&_.fire("mousemove",{originalEvent:t,x:e.x,y:e.y,z:e.z})}}function O(e,r){var i=t.getBoundingClientRect();e-=i.left,r-=i.top;var a=_.getPixelRatio(),s=a*e/n*2-1,u=2*(1-a*r/o)-1,c=g.transformMat4([0,0,0,0],[s,u,0,1],p);c[0]/=c[3],c[1]/=c[3],c[2]/=c[3],c[3]/=c[3],g.transformMat4(c,c,h.cameraWorld),y.sub(c,c,h.position),y.normalize(c,c);var l=(0-h.position[2])/c[2];return c[2],g.scaleAndAdd(c,h.position,c,l),{x:c[0],y:c[1],z:c[2]}}function F(t){if(void 0===t&&(t=!1),t)return D();u||(u=requestAnimationFrame(D))}function D(){s.clear(s.COLOR_BUFFER_BIT),c.updateWorldTransform(),c.draw(s,E),u=0}}J.prototype.reset=function(){this.state=0,this.canRotate=!1,this.canScale=!1,this.canIncline=!1,this.first=void 0,this.second=void 0},J.prototype.isUnknown=function(){return 0===this.state},J.prototype.track=function(t,e){if(this.stateChanged=!1,0===this.state){if(!this.first||!this.second)return this.first={id:t.id,x:t.x,y:t.y},void(this.second={id:e.id,x:e.x,y:e.y});var n=this.first,r=this.second;if(t.id===r.id&&e.id===n.id){var o=n;n=r,r=o}var i=n.y-r.y,a=n.x-r.x,s=t.y-e.y,u=t.x-e.x,c=Math.abs(Math.hypot(i,a)-Math.hypot(s,u)),l=Math.atan2(i,a),f=Math.abs(l-Math.atan2(s,u));if(((l=180*Math.abs(l)/Math.PI)<60||180-l<60)&&this.allowRotation&&Math.abs(t.createdAt-e.createdAt)<100){var h=t.x-n.x+e.x-r.x,d=t.y-n.y+e.y-r.y;Math.abs(h)<10&&Math.abs(d)>42&&(this.canIncline=!0)}this.canIncline?(this.canRotate=!1,this.canScale=!1,this.canIncline=!0,this.state=3):f>.1&&this.allowRotation?(this.canRotate=!0,this.canScale=!0,this.canIncline=!1,this.state=2):c>15&&(this.canRotate=!1,this.canScale=!0,this.canIncline=!1,this.state=1),this.stateChanged=!0}},M.setMatrixArrayType(Float64Array);var ut={compile:function(t,e,n){var r=t.createShader(e);if(!r)throw new Error("Failed to create a shared "+n);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r)||"Failed to compile shader "+n);return r},link:function(t,e,n){var r=t.createProgram();if(!r)throw new Error("Failed to link a program");if(t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(r)||"Failed to link a program");return r},getLocations:function(t,e){return{attributes:ct(t,e),uniforms:lt(t,e)}},getAttributes:ct,getUniforms:lt,initBuffer:function(t,e,n,r){var o=t.createBuffer();if(!o)throw new Error("Failed to create a buffer");t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.vertexAttribPointer(r,n,t.FLOAT,!1,0,0),t.enableVertexAttribArray(r)}};function ct(t,e){for(var n=Object.create(null),r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;o<r;++o){var i=t.getActiveAttrib(e,o);if(i){var a=i.name;n[a]=t.getAttribLocation(e,a)}}return n}function lt(t,e){for(var n=Object.create(null),r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),o=0;o<r;++o){var i=t.getActiveUniform(e,o);if(i){var a=i.name;n[a]=t.getUniformLocation(e,a)}}return n}function ft(){var t=new Map;return{get:function(e){if(!e)return;for(var n,r=t,o=0;o<e.length;++o){var i=e[o];if(!(n=r.get(i)))return;r=n}return n},set:function(e,n){for(var r=t,o=0;o<e.length-1;++o){var i=e[o],a=r.get(i);a||(a=new Map,r.set(i,a)),r=a}r.set(e[e.length-1],n)},remove:function(e){for(var n=t,r=0;r<e.length-1;++r){var o=e[r],i=n.get(o);if(!i)return;n=i}n.delete(e[e.length-1])}}}var ht=ft();var dt=function(t,e,n,r){void 0===r&&(r=1),this.r=t,this.g=e,this.b=n,this.a=void 0===r?1:r},pt=function(t,e,n){this.offset=e,this._points=t,void 0!==n&&(this.data=n)};pt.prototype.update=function(t){var e=this.offset,n=this._points.positions,r=this._points.is3D;n[e]=t.x,n[++e]=t.y,e++,r&&(n[e]=t.z||0,e++);var o=t.size||this._points.size||1;void 0!==o&&(n[e]=o),this.setColor(t.color)},pt.prototype.setColor=function(t){if(this._points.colors&&void 0!==t){var e=this.offset+(this._points.is3D?4:3);this._points.colors[e]=t}};var vt=function(t){function e(e,n){if(void 0===e)throw new Error("Point capacity should be defined");t.call(this),this.is3D=!n||void 0===n.is3D||n.is3D,this.allowColors=!n||void 0===n.allowColors||n.allowColors,this.itemsPerPoint=3,this.is3D&&(this.itemsPerPoint+=1),this.allowColors&&(this.itemsPerPoint+=1),this.capacity=e,this.count=0,this.color=new dt(1,1,1,1),this._program=null,this.buffer=new ArrayBuffer(e*this.itemsPerPoint*4),this.positions=new Float32Array(this.buffer),this.colors=this.allowColors?new Uint32Array(this.buffer):null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.draw=function(t,e){this._program||(this._program=function(t,e){var n=!!e.allowColors,r=[n,t],o=ht.get(r);if(!o){var i=function(t){return{fragmentShaderCode:"\n  precision highp float;\n  varying vec4 vColor;\n  varying vec3 vPosition;\n\n  void main() {\n    float dist = length(vPosition);\n\n    if (dist >= 0.5) {discard;}\n    gl_FragColor = vColor;\n  }\n  ",vertexShaderCode:"\n  uniform vec4 uColor;\n  uniform mat4 projectionMatrix;\n  uniform mat4 uModel;\n  uniform mat4 uView;\n\n  attribute float aPointSize;\n  attribute vec3 aPosition;\n  attribute vec3 aPoint;\n  "+(t?"attribute vec4 aColor;":"")+"\n\n  varying vec4 vColor;\n  varying vec3 vPosition;\n\n  void main() {\n    vPosition = aPoint;\n    gl_Position = projectionMatrix * uView * uModel * vec4( aPosition + aPoint * aPointSize, 1.0 );\n    vColor = "+(t?"aColor.abgr":"uColor")+";\n  }\n"}}(n),a=i.fragmentShaderCode,s=i.vertexShaderCode,u=ut.compile(t,t.VERTEX_SHADER,s),c=ut.compile(t,t.FRAGMENT_SHADER,a);o=ut.link(t,u,c),ht.set(r,o)}var l=ut.getLocations(t,o),f=t.getExtension("ANGLE_instanced_arrays");if(!f)throw new Error("PointCollection requires instancing. Please ping @anvaka so that we can add fallback");var h=t.createBuffer();if(!h)throw new Error("failed to create a nodesBuffer");var d=t.createBuffer(),p=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5]),v=e.is3D?3:2,m=4*v,g=4*(v+1),y=4*(v+2),b=4*(v+1);return{draw:function(r){if(e.count){if(t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.useProgram(o),t.uniformMatrix4fv(l.uniforms.uModel,!1,e.worldModel),t.uniformMatrix4fv(l.uniforms.projectionMatrix,!1,r.projection),t.uniformMatrix4fv(l.uniforms.uView,!1,r.view.matrix),t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,p,t.STATIC_DRAW),t.enableVertexAttribArray(l.attributes.aPoint),t.vertexAttribPointer(l.attributes.aPoint,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,e.buffer,t.DYNAMIC_DRAW),n)t.enableVertexAttribArray(l.attributes.aPosition),t.vertexAttribPointer(l.attributes.aPosition,v,t.FLOAT,!1,y,0),t.enableVertexAttribArray(l.attributes.aPointSize),t.vertexAttribPointer(l.attributes.aPointSize,1,t.FLOAT,!1,y,m),t.enableVertexAttribArray(l.attributes.aColor),t.vertexAttribPointer(l.attributes.aColor,4,t.UNSIGNED_BYTE,!0,y,g);else{t.enableVertexAttribArray(l.attributes.aPosition),t.vertexAttribPointer(l.attributes.aPosition,v,t.FLOAT,!1,b,0),t.enableVertexAttribArray(l.attributes.aPointSize),t.vertexAttribPointer(l.attributes.aPointSize,1,t.FLOAT,!1,b,m);var i=e.color;t.uniform4f(l.uniforms.uColor,i.r,i.g,i.b,i.a)}f.vertexAttribDivisorANGLE(l.attributes.aPoint,0),f.vertexAttribDivisorANGLE(l.attributes.aPosition,1),f.vertexAttribDivisorANGLE(l.attributes.aPointSize,1),f.vertexAttribDivisorANGLE(l.attributes.aColor,1),f.drawArraysInstancedANGLE(t.TRIANGLES,0,6,e.count),f.vertexAttribDivisorANGLE(l.attributes.aPosition,0),f.vertexAttribDivisorANGLE(l.attributes.aPoint,0),f.vertexAttribDivisorANGLE(l.attributes.aPointSize,0),f.vertexAttribDivisorANGLE(l.attributes.aColor,0),t.disable(t.DEPTH_TEST)}},dispose:function(){t.deleteProgram(o),ht.remove(r)}}}(t,this)),this._program.draw(e)},e.prototype.dispose=function(){this._program&&(this._program=null)},e.prototype.add=function(t,e){if(!t)throw new Error("Point is required");this.count>=this.capacity&&this._extendArray();var n=this.count*this.itemsPerPoint,r=new pt(this,n,e);return r.update(t),this.count+=1,r},e.prototype._extendArray=function(){var t=new ArrayBuffer(2*this.buffer.byteLength),e=new Float32Array(t);this.positions&&e.set(this.positions),this.buffer=t,this.positions=e,this.allowColors&&(this.colors=new Uint32Array(t)),this.capacity*=2},e}(x),mt=ft();function gt(t,e){var n=!!e.allowColors,r=[n,t],o=mt.get(r);if(!o){var i=function(t){return{vert:"attribute vec3 aPosition;\n  varying vec4 vColor;\n  "+(t?"attribute vec4 aColor;":"")+"\n  uniform vec4 uColor;\n  uniform mat4 projectionMatrix;\n  uniform mat4 uModel;\n  uniform mat4 uView;\n\nvoid main() {\n  gl_Position = projectionMatrix * uView * uModel * vec4(aPosition, 1.0);\n  vColor = "+(t?"aColor.abgr":"uColor")+";\n}",frag:"precision mediump float;\n    varying vec4 vColor;\n    void main() {\n      gl_FragColor = vColor;\n    }"}}(n),a=i.frag,s=i.vert,u=ut.compile(t,t.VERTEX_SHADER,s),c=ut.compile(t,t.FRAGMENT_SHADER,a);o=ut.link(t,u,c),mt.set(r,o)}var l=ut.getLocations(t,o),f=t.createBuffer(),h=e.is3D?3:2,d=4*(h+1),p=4*h;return{draw:function(r){if(0===e.count)return;var i=e.buffer;t.useProgram(o),t.uniformMatrix4fv(l.uniforms.uModel,!1,e.worldModel),t.uniformMatrix4fv(l.uniforms.projectionMatrix,!1,r.projection),t.uniformMatrix4fv(l.uniforms.uView,!1,r.view.matrix);var a=e.color;t.uniform4f(l.uniforms.uColor,a.r,a.g,a.b,a.a),t.bindBuffer(t.ARRAY_BUFFER,f),e.isDirtyBuffer&&(t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),e.isDirtyBuffer=!1);t.enableVertexAttribArray(l.attributes.aPosition),n?(t.vertexAttribPointer(l.attributes.aPosition,h,t.FLOAT,!1,d,0),t.enableVertexAttribArray(l.attributes.aColor),t.vertexAttribPointer(l.attributes.aColor,4,t.UNSIGNED_BYTE,!0,d,p)):t.vertexAttribPointer(l.attributes.aPosition,h,t.FLOAT,!1,4*h,0);t.drawArrays(t.LINES,0,2*e.count)},dispose:function(){t.deleteBuffer(f),t.deleteProgram(o),mt.remove(r)}}}var yt=ft();var bt=function(t,e){this.offset=e,this._wire=t,this.update=t.is3D?this.update3D:this.update2D};function wt(t){return Math.round(255*t.r)<<24|Math.round(255*t.g)<<16|Math.round(255*t.b)<<8|Math.round(255*t.a)}function Mt(t){return[t>>24&1,t>>16&1,t>>8&1,1&t]}function xt(t){return"#"+At(t[0])+At(t[1])+At(t[2])}function At(t){var e=Math.floor(255*t).toString(16);return 1===e.length?"0"+e:e}bt.prototype.update2D=function(t,e){this._wire.isDirtyBuffer=!0;var n=this._wire.positions,r=this.offset;n[r+0]=t.x,n[r+1]=t.y,r+=2;var o=this._wire.allowColors;o&&(void 0!==t.color&&(this._wire.colors[r]=t.color),r+=1),n[r+0]=e.x,n[r+1]=e.y,o&&void 0!==e.color&&(this._wire.colors[r+2]=e.color)},bt.prototype.update3D=function(t,e){this._wire.isDirtyBuffer=!0;var n=this._wire.positions,r=this.offset;n[r+0]=t.x,n[r+1]=t.y,n[r+2]=t.z||0,r+=3;var o=this._wire.allowColors;o&&(void 0!==t.color?this._wire.colors[r]=t.color:this._wire.colors[r]=wt(this._wire.color),r+=1),n[r+0]=e.x,n[r+1]=e.y,n[r+2]=e.z||0,o&&(void 0!==e.color?this._wire.colors[r+3]=e.color:this._wire.colors[r+3]=wt(this._wire.color))};var Et=function(t){function e(e,n){t.call(this);this.allowColors=!n||void 0===n.allowColors||n.allowColors,this.is3D=!n||void 0===n.is3D||n.is3D,this.itemsPerLine=4,this.is3D&&(this.itemsPerLine+=2),this.allowColors&&(this.itemsPerLine+=2),this.capacity=e,this.count=0,this.color=new dt(1,1,1,1),this.type="WireCollection",this._program=null,this.buffer=new ArrayBuffer(e*this.itemsPerLine*4),this.positions=new Float32Array(this.buffer),this.width=n&&n.width||1,this.allowColors?this.colors=new Uint32Array(this.buffer):this.colors=null,this.isDirtyBuffer=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.draw=function(t,e){this._program||(this._program=_t(this.width)?function(t,e){var n;if(!(Number.isFinite(e.width)&&e.width>0&&1!==e.width))return gt(t,e);if(!(n=t.getExtension("ANGLE_instanced_arrays")))return console.error("ANGLE_instanced_arrays is not supported, thick lines are not possible"),gt(t,e);var r=!!e.allowColors,o=[r,t],i=yt.get(o);if(!i){var a=function(t){return{vert:"attribute vec3 aPosition, aFrom, aTo;\n    varying vec4 vColor;\n    "+(t?"attribute vec4 aFromColor, aToColor;":"")+"\n    uniform vec4 uColor;\n    uniform mat4 projectionMatrix;\n    uniform mat4 uModel;\n    uniform mat4 uView;\n    uniform float uWidth;\n    uniform vec2 uResolution;\n  \n  void main() {\n    // let's get the model point to clip space:\n    vec4 clip0 = projectionMatrix * uView * uModel * vec4(aFrom, 1.0);\n    vec4 clip1 = projectionMatrix * uView * uModel * vec4(aTo, 1.0);\n\n    // And from the clip space move to the screen pixels \n    // (as we set width of the lines in pixels)\n    vec2 screen0 = uResolution * (0.5 * clip0.xy/clip0.w + 0.5);\n    vec2 screen1 = uResolution * (0.5 * clip1.xy/clip1.w + 0.5);\n\n    // this is direction along the x axis\n    vec2 xBasis = normalize(screen1 - screen0);\n    // But since we set the width, we get the direction along the Y:\n    vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n\n    // Offset the original points:\n    vec2 pt0 = screen0 + uWidth * aPosition.x * yBasis;\n    vec2 pt1 = screen1 + uWidth * aPosition.x * yBasis;\n\n    // and interpolate along the Y of the instanced geometry \n    // (remember, Y changes from 0 to 1):\n    vec2 pt = mix(pt0, pt1, aPosition.y);\n    vec4 clip = mix(clip0, clip1, aPosition.y);\n\n    // Finally move back to the clip space:\n    gl_Position = vec4(clip.w * (2.0 * pt/uResolution - 1.0), clip.z, clip.w);\n    vColor = "+(t?"mix(aFromColor.abgr, aToColor.abgr, aPosition.y)":"uColor")+";\n  }",frag:"precision mediump float;\n    varying vec4 vColor;\n    void main() {\n      gl_FragColor = vColor;\n    }"}}(r),s=a.frag,u=a.vert,c=ut.compile(t,t.VERTEX_SHADER,u),l=ut.compile(t,t.FRAGMENT_SHADER,s);i=ut.link(t,c,l),yt.set(o,i)}var f=ut.getLocations(t,i),h=t.createBuffer(),d=e.is3D?3:2,p=r?2*(d+1)*4:2*d*4,v=t.createBuffer(),m=new Float32Array([-.5,0,-.5,1,.5,1,-.5,0,.5,1,.5,0]);return{isThickWire:!0,draw:function(o){if(0!==e.count){var a=e.buffer;t.useProgram(i),t.uniformMatrix4fv(f.uniforms.uModel,!1,e.worldModel),t.uniformMatrix4fv(f.uniforms.projectionMatrix,!1,o.projection),t.uniformMatrix4fv(f.uniforms.uView,!1,o.view.matrix),t.uniform3fv(f.uniforms.uOrigin,o.view.position),t.uniform1f(f.uniforms.uWidth,e.width),t.uniform2f(f.uniforms.uResolution,o.width,o.height);var s=e.color;t.uniform4f(f.uniforms.uColor,s.r,s.g,s.b,s.a),t.bindBuffer(t.ARRAY_BUFFER,v),t.bufferData(t.ARRAY_BUFFER,m,t.STATIC_DRAW),t.enableVertexAttribArray(f.attributes.aPosition),t.vertexAttribPointer(f.attributes.aPosition,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,a,t.DYNAMIC_DRAW),t.enableVertexAttribArray(f.attributes.aFrom),t.vertexAttribPointer(f.attributes.aFrom,d,t.FLOAT,!1,p,0),r?(t.enableVertexAttribArray(f.attributes.aFromColor),t.vertexAttribPointer(f.attributes.aFromColor,4,t.UNSIGNED_BYTE,!0,p,4*d),t.enableVertexAttribArray(f.attributes.aTo),t.vertexAttribPointer(f.attributes.aTo,d,t.FLOAT,!1,p,4*(d+1)),t.enableVertexAttribArray(f.attributes.aToColor),t.vertexAttribPointer(f.attributes.aToColor,4,t.UNSIGNED_BYTE,!0,p,4*(2*d+1))):(t.enableVertexAttribArray(f.attributes.aTo),t.vertexAttribPointer(f.attributes.aTo,d,t.FLOAT,!1,p,4*d)),n.vertexAttribDivisorANGLE(f.attributes.aPosition,0),n.vertexAttribDivisorANGLE(f.attributes.aTo,1),n.vertexAttribDivisorANGLE(f.attributes.aFrom,1),n.vertexAttribDivisorANGLE(f.attributes.aFromColor,1),n.vertexAttribDivisorANGLE(f.attributes.aToColor,1),n.drawArraysInstancedANGLE(t.TRIANGLES,0,6,e.count),n.vertexAttribDivisorANGLE(f.attributes.aFrom,0),n.vertexAttribDivisorANGLE(f.attributes.aTo,0),n.vertexAttribDivisorANGLE(f.attributes.aFromColor,0),n.vertexAttribDivisorANGLE(f.attributes.aToColor,0)}},dispose:function(){h&&t.deleteBuffer(h),v&&t.deleteBuffer(v),f&&(t.disableVertexAttribArray(f.attributes.aFrom),t.disableVertexAttribArray(f.attributes.aFromColor),t.disableVertexAttribArray(f.attributes.aTo),t.disableVertexAttribArray(f.attributes.aToColor),t.disableVertexAttribArray(f.attributes.aPosition)),t.deleteProgram(i),yt.remove(o)}}}(t,this):gt(t,this)),this._program.draw(e)},e.prototype.setLineWidth=function(t){if(t!==this.width){var e=_t(t);if(this.width=t,this._program&&this.scene)if(e&&this._program.isThickWire)this.scene.renderFrame();else if(this.parent){var n=this.parent;n.removeChild(this),this.dispose(),n.appendChild(this)}}},e.prototype.add=function(t){if(!t)throw new Error("Line is required");this.count>=this.capacity&&this._extendArray();var e=this.count*this.itemsPerLine,n=new bt(this,e);return n.update(t.from,t.to),this.count+=1,n},e.prototype.getLineColor=function(t,e){return this.allowColors&&t&&t.color&&e&&e.color?function(t,e,n){void 0===n&&(n=.5);var r=Mt(t),o=Mt(e);return[r[0]*n+(1-n)*o[0],r[1]*n+(1-n)*o[1],r[2]*n+(1-n)*o[2],r[3]*n+(1-n)*o[3]]}(t.color,e.color):[this.color.r,this.color.g,this.color.b,this.color.a]},e.prototype.forEachLine=function(t){var e=this.positions,n=this.count,r=this.itemsPerLine,o=n*r;if(this.is3D)for(var i=0;i<o;i+=r){var a={x:e[i],y:e[i+1],z:e[i+2]},s=i+3;this.colors&&(a.color=this.colors[i+3],s+=1);var u={x:e[s],y:e[s+1],z:e[s+2]};this.colors&&(u.color=this.colors[s+3]),t(a,u)}else for(var c=0;c<o;c+=r){var l={x:e[c],y:e[c+1],z:0},f=c+2;this.colors&&(l.color=this.colors[c+2],f+=1);var h={x:e[f],y:e[f+1],z:0};this.colors&&(h.color=this.colors[f+2]),t(l,h)}},e.prototype.dispose=function(){this._program&&(this._program=null)},e.prototype._extendArray=function(){var t=new ArrayBuffer(2*this.buffer.byteLength),e=new Float32Array(t);this.positions&&e.set(this.positions),this.buffer=t,this.positions=e,this.allowColors&&(this.colors=new Uint32Array(t)),this.capacity*=2},e}(x);function _t(t){return void 0!==t&&1!==t&&t>0}var Pt=ft();var Lt=function(t){function e(e,n){t.call(this);this.drawCount=0,this.madeFullCircle=!1,this.allowColors=!n||void 0===n.allowColors||n.allowColors,this.is3D=!n||void 0===n.is3D||n.is3D,this.itemsPerLine=2,this.allowColors&&(this.itemsPerLine+=1),this.is3D&&(this.itemsPerLine+=1),this.capacity=e,this.nextElementIndex=1,this._program=null,this.color=new dt(1,1,1,1),this.buffer=new ArrayBuffer((e+1)*this.itemsPerLine*4),this.positions=new Float32Array(this.buffer),this.allowColors?this.colors=new Uint32Array(this.buffer):this.colors=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.draw=function(t,e){this._program||(this._program=function(t,e){var n=e.allowColors,r=e.is3D,o=[n=!!n,t],i=Pt.get(o),a=2+(n?1:0)+(r?1:0),s=e.buffer;if(!i){var u=function(t){return{lineVSSrc:"attribute vec3 aPosition;\n  varying vec4 vColor;\n  "+(t?"attribute vec4 aColor;":"")+"\n  uniform vec4 uColor;\n  uniform mat4 projectionMatrix;\n  uniform mat4 uModel;\n  uniform mat4 uView;\n  void main() {\n    gl_Position = projectionMatrix * uView * uModel * vec4(aPosition, 1.0);\n    vColor = "+(t?"aColor.abgr":"uColor")+";\n  }",lineFSSrc:"precision mediump float;\nvarying vec4 vColor;\nvoid main() {\n  gl_FragColor = vColor;\n}\n"}}(n),c=u.lineFSSrc,l=u.lineVSSrc,f=ut.compile(t,t.VERTEX_SHADER,l),h=ut.compile(t,t.FRAGMENT_SHADER,c);i=ut.link(t,f,h),Pt.set(o,i)}var d=ut.getLocations(t,i),p=r?3:2,v=4*(p+1),m=4*p,g=t.createBuffer();return{draw:function(e,r){if(0!==s.length){t.useProgram(i),t.uniformMatrix4fv(d.uniforms.uModel,!1,e.worldModel),t.uniformMatrix4fv(d.uniforms.projectionMatrix,!1,r.projection),t.uniformMatrix4fv(d.uniforms.uView,!1,r.view.matrix),t.uniform3fv(d.uniforms.uOrigin,r.view.position);var o=e.color,u=e.nextElementIndex,c=e.madeFullCircle;if(t.uniform4f(d.uniforms.uColor,o.r,o.g,o.b,o.a),t.bindBuffer(t.ARRAY_BUFFER,g),t.enableVertexAttribArray(d.attributes.aPosition),t.bufferData(t.ARRAY_BUFFER,s,t.DYNAMIC_DRAW),n?(t.vertexAttribPointer(d.attributes.aPosition,p,t.FLOAT,!1,v,0),t.enableVertexAttribArray(d.attributes.aColor),t.vertexAttribPointer(d.attributes.aColor,4,t.UNSIGNED_BYTE,!0,v,m)):t.vertexAttribPointer(d.attributes.aPosition,p,t.FLOAT,!1,0,0),c){var l=s.byteLength/4/a-u;t.drawArrays(t.LINE_STRIP,u,l),u>1&&t.drawArrays(t.LINE_STRIP,0,u-1)}else t.drawArrays(t.LINE_STRIP,1,u-1)}},dispose:function(){t.deleteBuffer(g),t.deleteProgram(i),Pt.remove(o)}}}(t,this)),this._program.draw(this,e)},e.prototype.add=function(t){var e=this.nextElementIndex*this.itemsPerLine,n=this.positions;if(n[e]=t.x,n[e+=1]=t.y,e+=1,this.is3D&&(n[e]=t.z||0,e+=1),this.colors&&(this.colors[e]=void 0===t.color?4294967295:t.color),this.nextElementIndex+=1,this.drawCount+=1,this.nextElementIndex>this.capacity){this.nextElementIndex=1;var r=0;n[r]=t.x,n[r+=1]=t.y,r+=1,this.is3D&&(n[r]=t.z||0,r+=1),this.colors&&(this.colors[r]=this.colors[e]),this.madeFullCircle=!0}},e.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null)},e}(x);function Ct(t){try{return!!window.WebGLRenderingContext&&(t||(t=document.createElement("canvas")),!(!t.getContext("webgl")&&!t.getContext("experimental-webgl")))}catch(t){return!1}}var St=function(t){"uniqueLinkId"in(t=t||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),t.multigraph=t.uniqueLinkId);void 0===t.multigraph&&(t.multigraph=!1);if("function"!=typeof Map)throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,n=[],o={},i=0,a=t.multigraph?function(t,e,n){var r=It(t,e),i=o.hasOwnProperty(r);if(i||x(t,e)){i||(o[r]=0);var a="@"+ ++o[r];r=It(t+a,e+a)}return new kt(t,e,n,r)}:function(t,e,n){var r=It(t,e);return new kt(t,e,n,r)},s=[],u=A,c=A,l=A,f=A,h={addNode:m,addLink:function(t,e,r){l();var o=g(t)||m(t),i=g(e)||m(e),s=a(t,e,r);n.push(s),Tt(o,s),t!==e&&Tt(i,s);return u(s,"add"),f(),s},removeLink:M,removeNode:y,getNode:g,getNodeCount:b,getLinkCount:w,getLinksCount:w,getNodesCount:b,getLinks:function(t){var e=g(t);return e?e.links:null},forEachNode:P,forEachLinkedNode:function(t,n,r){var o=g(t);if(o&&o.links&&"function"==typeof n)return r?function(t,n,r){for(var o=0;o<t.length;++o){var i=t[o];if(i.fromId===n&&r(e.get(i.toId),i))return!0}}(o.links,t,n):function(t,n,r){for(var o=0;o<t.length;++o){var i=t[o],a=i.fromId===n?i.toId:i.fromId;if(r(e.get(a),i))return!0}}(o.links,t,n)},forEachLink:function(t){var e,r;if("function"==typeof t)for(e=0,r=n.length;e<r;++e)t(n[e])},beginUpdate:l,endUpdate:f,clear:function(){l(),P(function(t){y(t.id)}),f()},hasLink:x,hasNode:g,getLink:x};return r(h),d=h.on,h.on=function(){return h.beginUpdate=l=E,h.endUpdate=f=_,u=p,c=v,h.on=d,d.apply(h,arguments)},h;var d;function p(t,e){s.push({link:t,changeType:e})}function v(t,e){s.push({node:t,changeType:e})}function m(t,n){if(void 0===t)throw new Error("Invalid node identifier");l();var r=g(t);return r?(r.data=n,c(r,"update")):(r=new function(t,e){this.id=t,this.links=null,this.data=e}(t,n),c(r,"add")),e.set(t,r),f(),r}function g(t){return e.get(t)}function y(t){var n=g(t);if(!n)return!1;l();var r=n.links;if(r){n.links=null;for(var o=0;o<r.length;++o)M(r[o])}return e.delete(t),c(n,"remove"),f(),!0}function b(){return e.size}function w(){return n.length}function M(t){if(!t)return!1;var e=Rt(t,n);if(e<0)return!1;l(),n.splice(e,1);var r=g(t.fromId),o=g(t.toId);return r&&(e=Rt(t,r.links))>=0&&r.links.splice(e,1),o&&(e=Rt(t,o.links))>=0&&o.links.splice(e,1),u(t,"remove"),f(),!0}function x(t,e){var n,r=g(t);if(!r||!r.links)return null;for(n=0;n<r.links.length;++n){var o=r.links[n];if(o.fromId===t&&o.toId===e)return o}return null}function A(){}function E(){i+=1}function _(){0===(i-=1)&&s.length>0&&(h.fire("changed",s),s.length=0)}function P(t){if("function"!=typeof t)throw new Error("Function is expected to iterate over graph nodes. You passed "+t);for(var n=e.values(),r=n.next();!r.done;){if(t(r.value))return!0;r=n.next()}}};function Rt(t,e){if(!e)return-1;if(e.indexOf)return e.indexOf(t);var n,r=e.length;for(n=0;n<r;n+=1)if(e[n]===t)return n;return-1}function Tt(t,e){t.links?t.links.push(e):t.links=[e]}function kt(t,e,n,r){this.fromId=t,this.toId=e,this.data=n,this.id=r}function It(t,e){return t.toString()+"👉 "+e.toString()}function Ot(t,e){void 0===e&&(e={});var n=t.getRoot();n.updateWorldTransform();var r=[],o=Object.assign({background:xt(t.getClearColor()),write:function(t){r.push(t)},scene:t},t.getDrawContext());return function(t,e){var n="0 0 "+t.width+" "+t.height;t.write('<?xml version="1.0" encoding="utf-8"?>'),e.open&&t.write(e.open());t.write('<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n    viewBox="'+n+'">\n<style>\n  path {\n   vector-effect: non-scaling-stroke;\n  }\n</style>\n'),t.background&&t.write('<rect id="background" fill="'+t.background+'" x="0" y="0" width="'+t.width+'" height="'+t.height+'"></rect>')}(o,e),function t(n){var r={beforeWrite:e.beforeWrite||Dt,round:void 0===e.round?void 0:e.round};for(var i=0;i<n.length;++i){var a=n[i],s=Ft(a);s&&Bt(s,o,r),t(a.children)}}(n.children),function(t,e){e.close&&t.write(e.close());t.write("</svg>")}(o,e),r.join("\n")}function Ft(t){if(t&&!t.svgInvisible)return t.forEachLine?t:void 0}function Dt(){return!0}function Bt(t,e,n){if(t.scene){var r=n.beforeWrite,o=n.round,i=St(),a=function(t,e,n){var r=e.width,o=e.height,i=e.projection,a=e.view,s=w.multiply(w.create(),i,a.matrix);w.multiply(s,s,t.worldModel);var u=function(t){if(void 0===t)return Nt;if(!0===t||0===t)return Math.round;return function(e){return Math.round(e*t)/t}}(n);return function(t,e,n){var i=g.transformMat4([0,0,0,0],[t,e,n||0,1],s),a=u(r*(i[0]/i[3]+1)*.5),c=u(o*(1-.5*(i[1]/i[3]+1)));return{x:a,y:c,isBehind:i[3]<=0}}}(t,e,o);if(t.forEachLine(function(n,r){var o=a(n.x,n.y,n.z),s=a(r.x,r.y,r.z);if(!o.isBehind&&!s.isBehind&&function(t,e,n,r){return jt(t,e,{x:0,y:0},{x:0,y:1})&&jt(t,e,{x:0,y:0},{x:1,y:0})&&jt(t,e,{x:0,y:r},{x:0,y:-1})&&jt(t,e,{x:n,y:0},{x:-1,y:0})}(o,s,e.width,e.height)){var u=xt(t.getLineColor(n,r)),c=o.x+"|"+o.y,l=s.x+"|"+s.y;i.getNode(c)||i.addNode(c,o),i.getNode(l)||i.addNode(l,s),i.hasLink(c,l)||i.addLink(c,l,{stroke:u})}}),0!==i.getLinksCount()){var s=xt(t.getLineColor()),u='fill="none" stroke-width="'+(void 0===t.width?1:t.width)/t.scene.getPixelRatio()+'" stroke="'+s+'"',c=t.id?'<g id="'+t.id+'" '+u+">":"<g "+u+">";e.write(c);var l=null,f=null;(function(t){var e=new Set,n=[],r=[];return t.forEachNode(function(o){e.has(o.id)||(r.push({to:o.id}),function(){for(var o=function(){var o=r.pop();o.to&&o.from&&n.push({from:o.from,to:o.to}),e.has(o.to)||(e.add(o.to),t.forEachLinkedNode(o.to,function(t){e.has(t.id)||r.push({from:o.to,to:t.id})},!1))};r.length;)o()}())}),n})(i).forEach(function(t){var e=t.from,n=t.to;if(e!==l)if(n===l){var r=e;e=n,n=r}else h(),f=[];f&&f.push(e,n),l=n}),h(),e.write("</g>")}}function h(){if(f){var t=f.map(function(t){var e=i.getNode(t);if(e)return e.data;throw new Error("Node is found in the path construction, but missing in the graph")});if(!r||r(t)){var n="M"+t[0].x+" "+t[0].y+" L"+t.slice(1).map(function(t){return t.x+" "+t.y}).join(",");e.write('<path d="'+n+'"/>')}}}}function Nt(t){return t}function jt(t,e,n,r){var o=qt(t,n,r),i=qt(e,n,r);if(o<=0&&i<=0)return!1;if(o>0&&i>0)return!0;var a=o/(o-i),s=t.x+a*(e.x-t.x),u=t.y+a*(e.y-t.y);return o<=0?(t.x=s,t.y=u):(e.x=s,e.y=u),!0}function qt(t,e,n){return(t.x-e.x)*n.x+(t.y-e.y)*n.y}function Yt(t,e){void 0===e&&(e={});var n=t.getCamera(),r={redraw:Function.prototype,dispose:Function.prototype},o=e.lineColor||196194594,i=e.maxAlpha||255,a=function(o){if(!1===e.showGrid)return r;var a=64,s=new Et(2*(a+1),{width:2.5,is3D:!0,allowColors:!0});s.svgInvisible=!0;var u=new Et(2*(a+1),{width:1.5,is3D:!0,allowColors:!0});u.svgInvisible=!0;var c=t.getDrawContext(),l=c.center;n.getRadius();return f(),t.appendChild(u),t.appendChild(s),{redraw:f,dispose:function(){t.removeChild(u),t.removeChild(s)}};function f(){var t,e=n.getRadius()*Math.tan(c.fov/2),r=Math.log10(e),o=Math.pow(10,Math.floor(r)),f=1-((t=r)-Math.floor(t)),d=Math.round(f*i),p=Math.floor(l[0]/o)*o-Math.floor(a*o/2),v=Math.floor(l[1]/o)*o-Math.floor(a*o/2),m=p+o*a,g=v+o*a;h(u,p,v,m,g,o,d),h(s,p,v,m,g,10*o,i-d)}function h(t,e,n,r,i,a,s){t.model[14]=l[2],t.worldTransformNeedsUpdate=!0,t.count=0;for(var u=4294967040&o|s,c=Math.ceil(n/a)*a,f=c;f<=i;f+=a)t.add({from:{x:e,y:f,color:u},to:{x:r,y:f,color:u}});for(var h=Math.ceil(e/a)*a,d=h;d<=r;d+=a)t.add({from:{x:d,y:n,color:u},to:{x:d,y:i,color:u}})}}(o),s=function(o){if(!1===e.showCursor)return r;var i,a=360,s=t.getDrawContext().center,u=new Et(a+1,{width:3,is3D:!0,allowColors:!0});u.svgInvisible=!0;for(var c=[],l=0;l<=a;++l)c.push(u.add({from:{x:0,y:0,color:o},to:{x:l,y:l,color:o}}));return t.appendChild(u),f(),{redraw:f,dispose:function(){t.removeChild(u)}};function f(){for(var t=.025*n.getRadius(),e=0;e<=a+1;++e){var r=e/a*2*Math.PI;if(0!==e){var l={x:t*Math.cos(r),y:t*Math.sin(r),color:o};c[e-1].update(i,l),i=l}else i={x:t*Math.cos(r),y:t*Math.sin(r),color:o}}u.model[12]=s[0],u.model[13]=s[1],u.model[14]=s[2],u.worldTransformNeedsUpdate=!0}}(e.cursorColor||4294967295);return t.on("transform",u),{dispose:function(){t.off("transform",u),a.dispose(),s.dispose()},update:u};function u(){a.redraw(),s.redraw()}}var Vt={mat4:"uniformMatrix4fv",mat3:"uniformMatrix3fv",mat2:"uniformMatrix2fv",vec4:"uniform4fv",vec3:"uniform3fv",vec2:"uniform2fv",float:"uniform1f"},zt=function(t,e){var n=Vt[e];if(!n)throw new Error("Function name for uniform is required");this.name=t,this.functionName=n,this.location=this.name+"UniformLocation"};zt.prototype.getInitBlockForDraw=function(){return"let "+this.location+" = gl.getUniformLocation(program, '"+this.name+"');"},zt.prototype.getDraw=function(){return this.functionName.indexOf("Matrix")>-1?"gl."+this.functionName+"("+this.location+", false, uniforms."+this.name+");":"gl."+this.functionName+"("+this.location+", uniforms."+this.name+");"};var Ut=function(t,e){void 0===e&&(e=0),this.name=t,this.offset=e,this.variableName=t+"Texture",this.ready=this.variableName+"Ready",this.location=this.name+"UniformLocation",this.isTexture=!0};Ut.prototype.getInitBlockForDraw=function(){return"\n  let "+this.location+" = gl.getUniformLocation(program, '"+this.name+"');\n  let "+this.variableName+" = gl.createTexture();\n  let "+this.ready+" = false;\n"},Ut.prototype.getTextureInitCanvasBlock=function(){return"\n  gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n  gl.bindTexture(gl.TEXTURE_2D, "+this.variableName+");\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureCanvas);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  "+this.ready+" = true"},Ut.prototype.getDraw=function(){return"\n    gl.activeTexture(gl.TEXTURE"+this.offset+");\n    gl.bindTexture(gl.TEXTURE_2D, "+this.variableName+");\n    gl.uniform1i("+this.location+", "+this.offset+");\n"};var Gt=function(){this.type="gl.FLOAT",this.debug=!1,this.bufferViewType="Float32Array",this.count=1,this.name=void 0,this.bytePerElement=4};Gt.prototype.setName=function(t){this.name=t},Gt.prototype.getInitBlockForBuffer=function(t){return this.ensureNameIsSet(),""+(t?"let ":"")+this.name+"Array = new "+this.bufferViewType+"(buffer);"},Gt.prototype.getInitBlockForDraw=function(){this.ensureNameIsSet();var t=this.name;return"let "+t+"AttributeLocation = gl.getAttribLocation(program, '"+t+"');"},Gt.prototype.getAddBlock=function(t){throw new Error("Concrete types have to implement this")},Gt.prototype.getGetBlock=function(t){throw new Error("Concrete types have to implement this")},Gt.prototype.getDivisor=function(t){this.ensureNameIsSet();var e=this.name+"AttributeLocation";return"if ("+e+" > -1) gle.vertexAttribDivisorANGLE("+e+", "+t+");"},Gt.prototype.getDraw=function(t,e){this.ensureNameIsSet();var n=this.name+"AttributeLocation";return"\n    gl.enableVertexAttribArray("+n+");\n    gl.vertexAttribPointer("+n+", "+this.count+", "+this.type+", false, "+t+", "+e+");"},Gt.prototype.ensureNameIsSet=function(){if(!this.name)throw new Error("You have to call setName() before using attributes")};var Wt=function(t){function e(e){t.call(this),this.count=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getAddBlock=function(t,e){void 0===e&&(e="\n");var n=this.name,r=n+"Array",o=[];this.debug&&o.push("if (item."+n+" === undefined) throw new Error('Attribute \""+n+"\" is missing');\n");for(var i=0;i<this.count;++i){var a="item."+n+"["+i+"]";this.debug&&o.push("if ("+a+" === undefined) throw new Error('Attribute \""+n+'" is missing value at index '+i+"');\n"),o.push(r+"[index + "+(t+i)+"] = "+a+";")}return{code:o.join(e),offset:t+this.count}},e.prototype.getGetBlock=function(t){for(var e=this.name+"Array",n=[],r=0;r<this.count;++r)n.push(e+"[index + "+(t+r)+"]");return this.name+": ["+n.join(", ")+"]"},e}(Gt),Xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getAddBlock=function(t){var e=this.name,n=e+"Array",r="";return this.debug&&(r="if (item."+e+" === undefined) throw new Error('Attribute \""+e+"\" is missing');"),{code:r+=n+"[index + "+t+"] = item."+e+";",offset:t+this.count}},e.prototype.getGetBlock=function(t){return this.name+": "+this.name+"Array[index + "+t+"]"},e}(Gt),Ht={vec4:function(){return new Wt(4)},vec3:function(){return new Wt(3)},vec2:function(){return new Wt(2)},float:function(){return new Xt}};var $t=function(){this.api=[],this.init=[],this.implementation=[],this.bufferInit=[]};function Qt(t){var e=t.gl,n=function(t){var e=[],n=[],r=function(t,e){var n=/attribute\s+(.+);/,r=/uniform\s+(.+);/,o=[],i=[];return t.split("\n").forEach(function(t){var e=t.match(n);if(e)a(e[1],o);else{var s=t.match(r);s&&a(s[1],i)}}),e.split("\n").forEach(function(t){var e=t.match(r);e&&a(e[1],i)}),{attributes:o,uniforms:i};function a(t,e){for(var n=t.replace(/,/g," ").split(" ").filter(function(t){return t}),r=n[0],o=function(t){var o=n[t];e.find(function(t){return t.name===o})||e.push({type:r,name:o})},i=1;i<n.length;++i)o(i)}}(t.vertex,t.fragment);r.attributes.forEach(function(r){var o=r.name,i=r.type,a=t.attributes&&t.attributes[o];if(a||"function"!=typeof Ht[i]||(a=Ht[i]()),!a)throw console.error("Unknown type "+i+" for "+o),new Error("Unknown type "+i+" for "+o);a.debug=t&&t.debug,a.setName(o);var s=t.instanced&&t.instanced[o];s?(s.setTypeDefinition(a),n.push(s)):e.push(a)});var o=[],i=0;r.uniforms.forEach(function(t){var e=t.name;"sampler2D"===t.type?o.push(new Ut(e,i++)):o.push(new zt(e,t.type))});var a=0,s=0;if(e.forEach(function(t){s+=t.count,a+=t.count*t.bytePerElement}),t.attributeLayout){var u=new Map;t.attributeLayout.forEach(function(t,e){return u.set(t,e)}),e.sort(function(t,e){return u.get(t.name)-u.get(e.name)})}return{bytePerVertex:a,itemPerVertex:s,attributes:e,instanced:n,uniforms:o}}(t),r=function(t,n){var r=c(e.VERTEX_SHADER,t),o=c(e.FRAGMENT_SHADER,n),i=e.createProgram();if(!i)throw new Error("Failed to link a program");if(e.attachShader(i,r),e.attachShader(i,o),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(i)||"Failed to link a program");return i}(t.vertex,t.fragment),o=t.preDrawHook||Zt,i=t.postDrawHook||Zt,a=function(e){var n=new $t;r=n,r.addToInit(["  let count = 0;"]),r.addToAPI(["setCount: (newCount) => count = newCount,","getCount: () => count,"]),t.sourceBuffer?function(t,e){e.addToInit(["let glBuffer;",""]),e.addToAPI(["setGLBuffer: (newBuffer) => glBuffer = newBuffer,"])}(0,n):(function(e,n){var r=e.attributes,o=e.bytePerVertex,i=e.itemPerVertex;n.addToInit(["let bytePerVertex = "+o+";","let itemPerVertex = "+i+";","let capacity = "+(t.capacity||1)*o+";","let buffer = new ArrayBuffer(capacity);","","let isDirty = true;","let dirtyOffset = 0;"]),r.forEach(function(t){n.addToInit(t.getInitBlockForBuffer(!0))}),n.addToAPI(["add: add,","get: get,","update: update,","getBuffer: getBuffer,","appendBuffer: appendBuffer,"]),n.addToImplementation(function(){var e=[],n=[],o=[],i=0;return r.forEach(function(t){var r=t.getInitBlockForBuffer(!1);r&&o.push(r);var a=t.getAddBlock(i);e.push(a.code),n.push(t.getGetBlock(i)),i=a.offset}),"\n  function add(item) {\n    if (count * bytePerVertex >= capacity) {\n      extend();\n    }\n\n    let index = count * itemPerVertex;\n\n    "+e.join("\n    ")+"\n\n    isDirty = true;\n    return count++;\n  }\n\n  function update(index, item) {\n    "+(t.debug?"\n    if (!Number.isFinite(index)) throw new Error('update() requires integer value for \"index\", got: ' + index);\n    if (index < 0 || index >= count) throw new Error('update(' + index + ') is outside of [0..' + count + ') range');\n":"")+"\n    index *= itemPerVertex;\n    "+e.join("\n    ")+"\n    isDirty = true;\n  }\n\n  function get(index) {\n    index *= itemPerVertex; \n    return {\n      "+n.join(",\n      ")+"\n    };\n  }\n\n  function extend() {\n    let oldBuffer = buffer;\n    capacity *= 2;\n    buffer = new ArrayBuffer(capacity);\n    // Copy old buffer to the new buffer\n    new Uint8Array(buffer).set(new Uint8Array(oldBuffer));\n    // And re-assign views:\n    "+o.join("\n    ")+"\n  }\n\n  function getBuffer() {\n    return buffer.slice(0, count * bytePerVertex);\n  }\n\n  function appendBuffer(uint8Collection, byteOffset) {\n    let requiredCapacity = byteOffset + uint8Collection.byteLength;\n    if (requiredCapacity > capacity) {\n      // extend the buffer to fulfill the request:\n      let oldBuffer = buffer;\n      buffer = new ArrayBuffer(requiredCapacity);\n      new Uint8Array(buffer).set(new Uint8Array(oldBuffer));\n      capacity = requiredCapacity;\n    }\n\n    let view = new Uint8Array(buffer);\n    view.set(uint8Collection, byteOffset);\n    count = Math.floor(requiredCapacity / bytePerVertex);\n\n    "+o.join("\n    ")+"\n\n    isDirty = true;\n  }\n"}())}(e,n),function(t,e){e.addToInit(["let glBuffer = gl.createBuffer();","if (!glBuffer) throw new Error('failed to create a WebGL buffer');",""]),e.addToAPI(["getGLBuffer: () => glBuffer,"])}(0,n));var r;return function(t,e){var n=[];if(t.uniforms.forEach(function(t){t instanceof Ut&&n.push(t)}),n.length){e.addToAPI("setTextureCanvas: setTextureCanvas,");var r=n.map(function(t){return"\n      case '"+t.name+"': {\n        "+t.getTextureInitCanvasBlock()+"\n        return;\n      }\n      "});e.addToImplementation("\n  function setTextureCanvas(textureName, textureCanvas) {\n    switch(textureName) {\n      "+r.join("\n      ")+"\n    }\n    throw new Error('Unknown texture name: ' + textureName);\n  }\n")}}(e,n),function(e,n){var r=e.attributes,a=e.instanced,s=e.uniforms,u=e.bytePerVertex,c=(e.itemPerVertex,t.sourceBuffer&&t.sourceBuffer.getCode());c?(n.addToInit(c.bufferInit),n.addBufferInit(c.bufferInit)):r.forEach(function(t){var e="  "+t.getInitBlockForDraw();n.addToInit(e),n.addBufferInit(e)});var l=[];s.forEach(function(t){n.addToInit("  "+t.getInitBlockForDraw()),t instanceof Ut&&l.push(t)}),a.length&&(n.addToInit("  let gle = gl.getExtension('ANGLE_instanced_arrays');\n  if (!gle) {\n    // Not sure if this is going to be an error, given instancing is widely supported. But\n    // If you get this error please ping me so that we can find a fallback solution\n    throw new Error('Instanced collection requires instancing support. Please ping @anvaka so that we can add fallback');\n  }\n"),a.forEach(function(t){n.addToInit("  "+t.getInitBlock())}));var f=[];if(c)f=c.attributesDrawBlock;else{var h=0;r.forEach(function(t){f.push(t.getDraw(u,h)),h+=t.count*t.bytePerElement})}n.setAttributesDrawBlock(f),n.addToImplementation(function(){var n=s.map(function(t){return t.getDraw()}),u=[],c=[],h=[];a.forEach(function(t){u.push(t.getDraw()),c.push(t.getDivisor(0)),h.push(t.getDivisor(0))});var d=[];return a.length?(r.forEach(function(t){c.push(t.getDivisor(1)),h.push(t.getDivisor(0))}),d.push(c.join("\n    ")),d.push("gle.drawArraysInstancedANGLE(gl.TRIANGLES, 0, 6, count)"),d.push(h.join("\n    "))):d.push("gl.drawArrays(gl.TRIANGLES, 0, count)")," \n  function draw(uniforms, from, to) {\n    if (count === 0) return;\n    "+(0===l.length?"":l.map(function(t){return"if (!"+t.ready+") return;"}).join("\n    "))+"\n    "+o(e)+"\n\n    gl.useProgram(program);\n    "+n.join("\n    ")+"\n    "+u.join("\n    ")+"\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, glBuffer);\n    "+(t.sourceBuffer?"":"  if (isDirty) {\n          gl.bufferData(gl.ARRAY_BUFFER, buffer, gl.DYNAMIC_DRAW);\n          isDirty = false;\n        }")+"\n\n    "+f.join("\n    ")+"\n    "+d.join("\n    ")+"\n\n    "+i(e)+"\n  }"}()),n.addToAPI(["draw: draw,"])}(e,n),n}(n),s=a.link(),u=new Function("gl","program",s)(e,r);return t.debug&&(console.log("Compiled code: "),console.log(s)),u.getCode=function(){return a},u.dispose=function(){e.deleteProgram(r)},u;function c(t,n){var r=e.createShader(t);if(!r)throw new Error("Failed to create a shared "+n);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw console.error(e.getShaderInfoLog(r)),new Error(e.getShaderInfoLog(r)||"Failed to compile shader "+n);return r}}function Zt(){return""}$t.prototype.addToInit=function(t){t&&this.init.push(t)},$t.prototype.addBufferInit=function(t){t&&this.bufferInit.push(t)},$t.prototype.addToAPI=function(t){t&&this.api.push(t)},$t.prototype.addToImplementation=function(t){t&&this.implementation.push(t)},$t.prototype.setAttributesDrawBlock=function(t){this.attributesDrawBlock=t},$t.prototype.link=function(){var t=[];return this.init.forEach(e),e("  return {"),this.api.forEach(e),e("  };"),this.implementation.forEach(e),t.join("\n");function e(e){Array.isArray(e)?t.push(e.join("\n    ")):t.push(e)}};var Kt=function(t){function e(){t.call(this),this.type="gl.UNSIGNED_BYTE",this.bufferViewType="Uint32Array"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getAddBlock=function(t){var e=this.name+"Array",n="";return this.debug&&(n="if (item."+this.name+" === undefined) throw new Error('Attribute \""+this.name+"\" is missing');\n"),{code:n+=e+"[index + "+t+"] = item."+this.name+";",offset:t+this.count}},e.prototype.getGetBlock=function(t){return this.name+": "+this.name+"Array[index + "+t+"]"},e.prototype.getDraw=function(t,e){var n=this.name+"AttributeLocation";return"\n    if ("+n+" > -1) {\n      gl.enableVertexAttribArray("+n+");\n      gl.vertexAttribPointer("+n+", 4, "+this.type+", true, "+t+", "+e+");\n    }"},e}(Gt),Jt=function(t){this.bufferValues=t,this.typeDef=void 0};Jt.prototype.setTypeDefinition=function(t){this.typeDef=t},Jt.prototype.getInitBlock=function(){var t=this.typeDef.name;return"\n  const "+t+"InstancedBuffer = gl.createBuffer();\n  if (!"+t+"InstancedBuffer) throw new Error('failed to create a WebGL buffer');\n  const "+t+"InstancedBufferValues = new Float32Array(["+this.bufferValues.join(",")+"]);\n  let "+t+"AttributeLocation = gl.getAttribLocation(program, '"+t+"');\n"},Jt.prototype.getDivisor=function(t){return this.typeDef.getDivisor(t)},Jt.prototype.getDraw=function(){var t=this.typeDef,e=t.name;return"\n  gl.bindBuffer(gl.ARRAY_BUFFER, "+e+"InstancedBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, "+e+"InstancedBufferValues, gl.STATIC_DRAW);\n\n  gl.enableVertexAttribArray("+e+"AttributeLocation);\n  gl.vertexAttribPointer("+e+"AttributeLocation, "+t.count+", gl.FLOAT, false, 0, 0);\n"};var te=function(t){function e(e){t.call(this),this.program=e,this.uniforms=void 0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getBuffer=function(){return this.program.getBuffer()},e.prototype.appendBuffer=function(t,e){this.program.appendBuffer(t,e),this.scene&&this.scene.renderFrame()},e.prototype.add=function(t){return this.program.add(t)},e.prototype.update=function(t,e){this.program.update(t,e)},e.prototype.get=function(t){return this.program.get(t)},e.prototype.draw=function(t,e){this.uniforms||(this.uniforms={projectionMatrix:e.projection,model:this.worldModel,view:e.view.matrix,modelViewProjection:this.modelViewProjection}),this.program.draw(this.uniforms)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.program&&this.program.dispose()},e}(x)},WJCp:function(t,e){},YzTF:function(t,e,n){"use strict";(function(t){var e=n("pFYg"),r=n.n(e);!function(e){var o=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,i=e.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),a=i&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),s=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,u=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,c=(i||s)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(t){var e,n,r,o,c,l,f,h,d;if(!(e=t.match(u)))throw new Error("invalid data URI");for(n=e[2]?e[1]:"text/plain"+(e[3]||";charset=US-ASCII"),r=!!e[4],o=t.slice(e[0].length),c=r?atob(o):decodeURIComponent(o),l=new ArrayBuffer(c.length),f=new Uint8Array(l),h=0;h<c.length;h+=1)f[h]=c.charCodeAt(h);return i?new Blob([a?f:l],{type:n}):((d=new s).append(l),d.getBlob(n))};e.HTMLCanvasElement&&!o.toBlob&&(o.mozGetAsFile?o.toBlob=function(t,e,n){var r=this;setTimeout(function(){n&&o.toDataURL&&c?t(c(r.toDataURL(e,n))):t(r.mozGetAsFile("blob",e))})}:o.toDataURL&&c&&(o.toBlob=function(t,e,n){var r=this;setTimeout(function(){t(c(r.toDataURL(e,n)))})})),"function"==typeof define&&n("nErl")?define(function(){return c}):"object"===r()(t)&&t.exports?t.exports=c:e.dataURLtoBlob=c}(window)}).call(e,n("f1Eh")(t))},Z2f9:function(t,e){},tvtY:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.3593f135b03788c80ae7.js.map